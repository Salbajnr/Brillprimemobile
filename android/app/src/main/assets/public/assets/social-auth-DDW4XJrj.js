class r{constructor(){this.initialized={},this.onAuthSuccess=()=>{},this.onAuthError=()=>{},this.config={google:{name:"Google",clientId:"",redirectUri:`${window.location.origin}/auth/google/callback`},apple:{name:"Apple",clientId:"",redirectUri:`${window.location.origin}/auth/apple/callback`},facebook:{name:"Facebook",clientId:"",redirectUri:`${window.location.origin}/auth/facebook/callback`}}}async initializeGoogle(){if(!this.initialized.google)return new Promise((e,i)=>{const o=document.createElement("script");o.src="https://accounts.google.com/gsi/client",o.onload=()=>{window.google?.accounts.id.initialize({client_id:this.config.google.clientId,callback:this.handleGoogleCallback.bind(this),auto_select:!1,cancel_on_tap_outside:!0}),this.initialized.google=!0,e()},o.onerror=()=>i(new Error("Failed to load Google SDK")),document.head.appendChild(o)})}async initializeFacebook(){if(!this.initialized.facebook)return new Promise((e,i)=>{window.fbAsyncInit=()=>{window.FB?.init({appId:this.config.facebook.clientId,cookie:!0,xfbml:!0,version:"v18.0"}),this.initialized.facebook=!0,e()};const o=document.createElement("script");o.src="https://connect.facebook.net/en_US/sdk.js",o.async=!0,o.defer=!0,o.crossOrigin="anonymous",o.onload=()=>{window.fbAsyncInit||i(new Error("Facebook SDK initialization failed"))},o.onerror=()=>i(new Error("Failed to load Facebook SDK")),document.head.appendChild(o)})}async initializeApple(){if(!this.initialized.apple)return new Promise((e,i)=>{const o=document.createElement("script");o.src="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js",o.onload=()=>{window.AppleID?.auth.init({clientId:this.config.apple.clientId,scope:"name email",redirectURI:this.config.apple.redirectUri,state:this.generateState(),usePopup:!0}),this.initialized.apple=!0,e()},o.onerror=()=>i(new Error("Failed to load Apple SDK")),document.head.appendChild(o)})}handleGoogleCallback(e){try{const i=this.parseJWT(e.credential),o={id:i.sub,email:i.email,name:i.name,picture:i.picture,provider:"google"};this.onAuthSuccess(o)}catch(i){this.onAuthError("Google authentication failed",i)}}parseJWT(e){try{const o=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),t=decodeURIComponent(atob(o).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(t)}catch{throw new Error("Invalid JWT token")}}generateState(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}setCallbacks(e,i){this.onAuthSuccess=e,this.onAuthError=i}async signInWithGoogle(){try{if(await this.initializeGoogle(),this.config.google.clientId)window.google?.accounts.id.prompt();else throw new Error("Google Client ID not configured")}catch(e){this.onAuthError("Google sign-in failed",e)}}async signInWithApple(){try{if(await this.initializeApple(),this.config.apple.clientId){const e=await window.AppleID?.auth.signIn();if(e){const i={id:e.user,email:e.email||"",name:e.name?`${e.name.firstName} ${e.name.lastName}`:"",provider:"apple"};this.onAuthSuccess(i)}}else throw new Error("Apple Client ID not configured")}catch(e){this.onAuthError("Apple sign-in failed",e)}}async signInWithFacebook(){try{if(await this.initializeFacebook(),this.config.facebook.clientId)window.FB?.login(e=>{if(e.status==="connected")window.FB?.api("/me",{fields:"id,name,email,picture"},i=>{const o={id:i.id,email:i.email||"",name:i.name,picture:i.picture?.data?.url,provider:"facebook"};this.onAuthSuccess(o)});else throw new Error("Facebook login failed")},{scope:"email,public_profile"});else throw new Error("Facebook App ID not configured")}catch(e){this.onAuthError("Facebook sign-in failed",e)}}async signOut(){try{this.initialized.google&&window.google&&window.google.accounts.id.disableAutoSelect(),this.initialized.facebook&&window.FB&&window.FB.logout()}catch(e){console.error("Sign out error:",e)}}isProviderConfigured(e){return!!this.config[e].clientId}}const c=new r;export{c as socialAuth};

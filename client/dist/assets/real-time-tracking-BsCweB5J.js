var Q=Object.defineProperty;var X=(e,s,r)=>s in e?Q(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r;var E=(e,s,r)=>X(e,typeof s!="symbol"?s+"":s,r);import{r as l,j as t,m as v,s as D,t as L,g as B,n as S,a as z,k as K,N as Z,L as ee,V as G,I as te,B as T,u as se,W as ae,Y as re,Z as ie,_ as ne,A as ce,$ as I,T as oe,o as le,p as V,P as de,q as W,K as me}from"./index-CPIh2kaR.js";import{M as ue}from"./message-circle-CUlruz96.js";import{S as he}from"./send-CBCYflFP.js";import{L as ge}from"./live-map-DXBjH6ZS.js";import{P as pe}from"./phone-2OSRHZsq.js";function xe(){const[e,s]=l.useState([]),[r,i]=l.useState(!0);return l.useEffect(()=>{const o=async()=>{try{const g=await fetch("/api/orders/active");if(g.ok){const m=await g.json();s(m.orders||[])}else console.error("Failed to fetch active orders"),s([])}catch(g){console.error("Error fetching orders:",g),s([])}finally{i(!1)}};o();const d=setInterval(o,3e4);return()=>clearInterval(d)},[]),r?t.jsx("div",{className:"p-4",children:"Loading orders..."}):t.jsx("div",{className:"space-y-4",children:e.map(o=>t.jsxs(v,{className:"w-full",children:[t.jsx(D,{children:t.jsxs(L,{className:"flex justify-between items-center",children:[t.jsxs("span",{children:["Order ",o.id]}),t.jsx(B,{variant:o.status==="IN_TRANSIT"?"default":"secondary",children:o.status})]})}),t.jsx(S,{children:t.jsxs("div",{className:"space-y-2",children:[o.driverName&&t.jsxs("p",{className:"text-sm",children:["Driver: ",o.driverName]}),o.estimatedArrival&&t.jsxs("p",{className:"text-sm",children:["ETA: ",new Date(o.estimatedArrival).toLocaleString()]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${o.completionPercentage}%`}})}),t.jsxs("p",{className:"text-sm text-gray-600",children:[o.completionPercentage,"% Complete"]})]})})]},o.id))})}const fe="/api";async function a(e,s={}){try{const r=await fetch(`${fe}${e}`,{credentials:"include",headers:{"Content-Type":"application/json",...s.headers},...s});let i;const o=r.headers.get("content-type");if(o&&o.includes("application/json")?i=await r.json():i={message:await r.text()},!r.ok){const d=i.message||i.error||`HTTP ${r.status}: Request failed`;throw new Error(d)}return i.success!==void 0?i:{success:!0,data:i}}catch(r){if(console.error(`API Error (${e}):`,r),e!=="/analytics/log-error")try{await fetch("/api/analytics/log-error",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoint:e,error:r.message,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href})})}catch(i){console.error("Failed to log error:",i)}return{success:!1,error:r.message||"Network error occurred"}}}class ye{constructor(){E(this,"ws",null);E(this,"reconnectAttempts",0);E(this,"maxReconnectAttempts",5);E(this,"listeners",new Map)}connect(){const r=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}`;this.ws=new WebSocket(r),this.ws.onopen=()=>{console.log("WebSocket connected"),this.reconnectAttempts=0},this.ws.onmessage=i=>{try{const o=JSON.parse(i.data);this.emit(o.type,o.payload)}catch(o){console.error("WebSocket message parsing error:",o)}},this.ws.onclose=()=>{console.log("WebSocket disconnected"),this.reconnect()},this.ws.onerror=i=>{console.error("WebSocket error:",i)}}reconnect(){this.reconnectAttempts<this.maxReconnectAttempts&&(this.reconnectAttempts++,setTimeout(()=>this.connect(),1e3*this.reconnectAttempts))}on(s,r){this.listeners.has(s)||this.listeners.set(s,[]),this.listeners.get(s).push(r)}emit(s,r){(this.listeners.get(s)||[]).forEach(o=>o(r))}disconnect(){this.ws&&(this.ws.close(),this.ws=null)}}const h=new ye,Ne={login:async e=>{const s=await a("/auth/login",{method:"POST",body:JSON.stringify(e)});return s.success&&h.connect(),s},register:async e=>{const s=await a("/auth/register",{method:"POST",body:JSON.stringify(e)});return s.success&&h.connect(),s},logout:async()=>{const e=await a("/auth/logout",{method:"POST"});return h.disconnect(),e},getCurrentUser:()=>a("/auth/me"),verifyOtp:e=>a("/auth/verify-otp",{method:"POST",body:JSON.stringify(e)}),resendOtp:e=>a("/auth/resend-otp",{method:"POST",body:JSON.stringify({phone:e})}),validateSession:()=>a("/auth/validate-session")},je={getStatus:()=>a("/verification-enhanced/status"),uploadDocument:async e=>(await fetch("/api/verification-enhanced/documents/upload",{method:"POST",credentials:"include",body:e})).json(),verifyBiometric:e=>a("/verification-enhanced/biometric/verify",{method:"POST",body:JSON.stringify(e)}),submitKyc:e=>a("/verification-enhanced/kyc/enhanced",{method:"POST",body:JSON.stringify(e)}),subscribeToUpdates:e=>{h.on("verification_update",e)}},be={getStatus:()=>a("/mfa/status"),setup:e=>a("/mfa/setup",{method:"POST",body:JSON.stringify(e)}),generateToken:e=>a("/mfa/generate-token",{method:"POST",body:JSON.stringify(e)}),verify:e=>a("/mfa/verify",{method:"POST",body:JSON.stringify(e)}),disable:e=>a("/mfa/disable",{method:"POST",body:JSON.stringify({confirmationToken:e})})},ve={initializePayment:e=>a("/payments/initialize",{method:"POST",body:JSON.stringify(e)}),verifyPayment:e=>a(`/payments/verify/${e}`),getPaymentMethods:()=>a("/payments/methods"),addPaymentMethod:e=>a("/payments/methods",{method:"POST",body:JSON.stringify(e)}),deletePaymentMethod:e=>a(`/payments/methods/${e}`,{method:"DELETE"}),subscribeToPaymentUpdates:e=>{h.on("payment_update",e)}},Se={getBalance:()=>a("/wallet/balance"),getTransactions:(e={})=>{const s=new URLSearchParams;return Object.entries(e).forEach(([r,i])=>{i!==void 0&&s.append(r,i.toString())}),a(`/wallet/transactions?${s}`)},fundWallet:e=>a("/wallet/fund",{method:"POST",body:JSON.stringify({amount:e})}),withdraw:e=>a("/withdrawal/initiate",{method:"POST",body:JSON.stringify(e)}),transfer:e=>a("/wallet/transfer",{method:"POST",body:JSON.stringify(e)}),subscribeToWalletUpdates:e=>{h.on("wallet_update",e)}},we={getOrders:(e={})=>{const s=new URLSearchParams;return Object.entries(e).forEach(([r,i])=>{i!==void 0&&s.append(r,i.toString())}),a(`/orders?${s}`)},getOrder:e=>a(`/orders/${e}`),createOrder:e=>a("/orders",{method:"POST",body:JSON.stringify(e)}),updateOrderStatus:(e,s,r)=>a(`/orders/${e}/status`,{method:"PUT",body:JSON.stringify({status:s,location:r})}),cancelOrder:(e,s)=>a(`/orders/${e}/cancel`,{method:"PUT",body:JSON.stringify({reason:s})}),subscribeToOrderUpdates:(e,s)=>{h.on(`order_${e}_update`,s)},bulkUpdateOrders:e=>a("/orders/bulk-update",{method:"PUT",body:JSON.stringify({updates:e})})},Te={getCategories:(e={})=>{const s=new URLSearchParams;return Object.entries(e).forEach(([r,i])=>{i!==void 0&&s.append(r,i.toString())}),a(`/categories?${s}`)},getCategory:e=>a(`/categories/${e}`),createCategory:e=>a("/categories",{method:"POST",body:JSON.stringify(e)}),updateCategory:(e,s)=>a(`/categories/${e}`,{method:"PUT",body:JSON.stringify(s)}),deleteCategory:e=>a(`/categories/${e}`,{method:"DELETE"})},Oe={getProducts:(e={})=>{const s=new URLSearchParams;return Object.entries(e).forEach(([r,i])=>{i!==void 0&&s.append(r,i.toString())}),a(`/products?${s}`)},getProduct:e=>a(`/products/${e}`),getCategories:()=>a("/products/categories"),createProduct:e=>a("/products",{method:"POST",body:JSON.stringify(e)}),updateProduct:(e,s)=>a(`/products/${e}`,{method:"PUT",body:JSON.stringify(s)}),deleteProduct:e=>a(`/products/${e}`,{method:"DELETE"}),subscribeToInventoryUpdates:(e,s)=>{h.on(`product_${e}_inventory`,s)}},Pe={updateLocation:e=>a("/drivers/location/update",{method:"POST",body:JSON.stringify({...e,timestamp:new Date().toISOString()})}),toggleAvailability:()=>a("/drivers/availability/toggle",{method:"POST"}),getActiveOrders:()=>a("/drivers/orders/active"),acceptOrder:e=>a(`/drivers/orders/${e}/accept`,{method:"POST"}),completeDelivery:(e,s)=>a(`/drivers/orders/${e}/complete`,{method:"POST",body:JSON.stringify(s)}),getEarnings:(e={})=>{const s=new URLSearchParams;return Object.entries(e).forEach(([r,i])=>{i!==void 0&&s.append(r,i.toString())}),a(`/drivers/earnings?${s}`)},subscribeToDriverUpdates:e=>{h.on("driver_update",e)},getPerformanceMetrics:()=>a("/drivers/performance")},ke={getOrderTracking:e=>a(`/tracking/order/${e}`),getDriverLocation:e=>a(`/tracking/driver/${e}`),updateDeliveryStatus:(e,s,r)=>a(`/tracking/order/${e}/status`,{method:"POST",body:JSON.stringify({status:s,location:r,timestamp:new Date().toISOString()})}),subscribeToOrderTracking:(e,s)=>{h.on(`tracking_${e}`,s)},subscribeToDriverTracking:(e,s)=>{h.on(`driver_location_${e}`,s)},getMultipleOrderTracking:e=>a("/tracking/orders/batch",{method:"POST",body:JSON.stringify({orderIds:e})})},Ee={createTicket:e=>{var r;const s=new FormData;return s.append("subject",e.subject),s.append("message",e.message),e.priority&&s.append("priority",e.priority),e.category&&s.append("category",e.category),(r=e.attachments)==null||r.forEach((i,o)=>{s.append(`attachment_${o}`,i)}),fetch("/api/support/tickets",{method:"POST",credentials:"include",body:s}).then(i=>i.json())},getTickets:(e={})=>{const s=new URLSearchParams;return Object.entries(e).forEach(([r,i])=>{i!==void 0&&s.append(r,i.toString())}),a(`/support/tickets?${s}`)},getTicket:e=>a(`/support/tickets/${e}`),addResponse:(e,s,r)=>{const i=new FormData;return i.append("message",s),r==null||r.forEach((o,d)=>{i.append(`attachment_${d}`,o)}),fetch(`/api/support/tickets/${e}/responses`,{method:"POST",credentials:"include",body:i}).then(o=>o.json())},subscribeToTicketUpdates:(e,s)=>{h.on(`ticket_${e}_update`,s)}},Ae={getNotifications:(e={})=>{const s=new URLSearchParams;return Object.entries(e).forEach(([r,i])=>{i!==void 0&&s.append(r,i.toString())}),a(`/notifications?${s}`)},markAsRead:e=>a(`/notifications/${e}/read`,{method:"PUT"}),markAllAsRead:()=>a("/notifications/read-all",{method:"PUT"}),deleteNotification:e=>a(`/notifications/${e}`,{method:"DELETE"}),subscribeToNotifications:e=>{h.on("new_notification",e)},getPreferences:()=>a("/notifications/preferences"),updatePreferences:e=>a("/notifications/preferences",{method:"PUT",body:JSON.stringify(e)})},De={getDashboardStats:e=>{const s=e?`?timeRange=${e}`:"";return a(`/analytics/dashboard${s}`)},getOrderStats:(e={})=>{const s=new URLSearchParams;return Object.entries(e).forEach(([r,i])=>{i!==void 0&&s.append(r,i.toString())}),a(`/analytics/orders?${s}`)},getRevenueStats:(e={})=>{const s=new URLSearchParams;return Object.entries(e).forEach(([r,i])=>{i!==void 0&&s.append(r,i.toString())}),a(`/analytics/revenue?${s}`)},getCustomerStats:()=>a("/analytics/customers"),getPopularProducts:e=>a(`/analytics/products/popular${e?`?limit=${e}`:""}`),subscribeToAnalytics:e=>{h.on("analytics_update",e)},getPerformanceMetrics:()=>a("/analytics/performance"),customQuery:e=>a("/analytics/custom",{method:"POST",body:JSON.stringify(e)})},Le={getStations:e=>{const s=e?`?lat=${e.lat}&lng=${e.lng}&radius=${e.radius||5}`:"";return a(`/fuel/stations${s}`)},createFuelOrder:e=>a("/fuel/orders",{method:"POST",body:JSON.stringify(e)}),getFuelOrders:()=>a("/fuel/orders"),getFuelOrder:e=>a(`/fuel/orders/${e}`),cancelFuelOrder:e=>a(`/fuel/orders/${e}/cancel`,{method:"PUT"})},$e={getTollGates:e=>e?a("/toll/gates/route",{method:"POST",body:JSON.stringify(e)}):a("/toll/gates"),calculateTollFee:e=>a("/toll/calculate",{method:"POST",body:JSON.stringify(e)}),payToll:e=>a("/toll/pay",{method:"POST",body:JSON.stringify(e)}),getTollHistory:()=>a("/toll/history")},A={auth:Ne,verification:je,mfa:be,payment:ve,wallet:Se,order:we,product:Oe,category:Te,driver:Pe,tracking:ke,support:Ee,notification:Ae,analytics:De,fuel:Le,toll:$e,wsManager:h,getDashboardData:()=>a("/dashboard")};function Ce({orderId:e,driverId:s,onLocationUpdate:r,showControls:i=!0,autoStart:o=!1}){const{user:d}=z(),[g,m]=l.useState(!1),[c,N]=l.useState(null),[p,$]=l.useState(null),[_,w]=l.useState(null),[H,U]=l.useState(!1),O=l.useRef(null),J=l.useRef(0);l.useEffect(()=>(e&&(A.tracking.subscribeToOrderTracking(e,n=>{$(u=>u?{...u,status:n.status,currentLocation:n.location,estimatedArrival:n.estimatedArrival}:null)}),M()),s&&A.tracking.subscribeToDriverTracking(s,n=>{N(n.location),r&&r(n.location)}),()=>{j()}),[e,s]),l.useEffect(()=>{o&&(d==null?void 0:d.role)==="DRIVER"&&F()},[o,d]);const M=async()=>{if(e){U(!0);try{const n=await A.tracking.getOrderTracking(e);n.success&&($(n.tracking),n.tracking.currentLocation&&N(n.tracking.currentLocation))}catch(n){console.error("Failed to fetch order tracking:",n),w("Failed to load tracking information")}finally{U(!1)}}},F=()=>{if(!navigator.geolocation){w("Geolocation is not supported by this browser");return}w(null),m(!0);const n={enableHighAccuracy:!0,timeout:1e4,maximumAge:5e3};O.current=navigator.geolocation.watchPosition(C,P,n)},j=()=>{O.current!==null&&(navigator.geolocation.clearWatch(O.current),O.current=null),m(!1)},C=async n=>{const u=Date.now();if(u-J.current<5e3)return;J.current=u;const f={latitude:n.coords.latitude,longitude:n.coords.longitude,heading:n.coords.heading||void 0,speed:n.coords.speed||void 0,accuracy:n.coords.accuracy,timestamp:new Date().toISOString()};if(N(f),(d==null?void 0:d.role)==="DRIVER")try{await A.driver.updateLocation(f)}catch(R){console.error("Failed to update location on server:",R)}r&&r(f)},P=n=>{let u="Unknown location error";switch(n.code){case n.PERMISSION_DENIED:u="Location access denied. Please enable location permissions.";break;case n.POSITION_UNAVAILABLE:u="Location information unavailable.";break;case n.TIMEOUT:u="Location request timed out.";break}w(u),m(!1)},k=async(n,u)=>{if(e)try{const f={status:n,notes:u};c&&(f.location={latitude:c.latitude,longitude:c.longitude}),(await A.tracking.updateDeliveryStatus(e,n,f.location)).success&&M()}catch(f){console.error("Failed to update tracking status:",f),w("Failed to update tracking status")}},x=n=>n<1e3?`${Math.round(n)}m`:`${(n/1e3).toFixed(1)}km`,q=n=>`${Math.round(n*3.6)} km/h`,b=n=>new Date(n).toLocaleTimeString();return H?t.jsxs("div",{className:"flex items-center justify-center p-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),t.jsx("span",{className:"ml-2",children:"Loading tracking information..."})]}):t.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[t.jsx(K,{className:"h-5 w-5 mr-2 text-blue-600"}),"Real-Time Tracking"]}),i&&(d==null?void 0:d.role)==="DRIVER"&&t.jsx("div",{className:"flex space-x-2",children:g?t.jsx("button",{onClick:j,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Stop Tracking"}):t.jsxs("button",{onClick:F,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center",children:[t.jsx(Z,{className:"h-4 w-4 mr-2"}),"Start Tracking"]})})]}),_&&t.jsxs("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg flex items-center",children:[t.jsx(ee,{className:"h-4 w-4 mr-2"}),_]}),c&&t.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Current Location"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Coordinates:"}),t.jsxs("div",{className:"font-mono",children:[c.latitude.toFixed(6),", ",c.longitude.toFixed(6)]})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Last Update:"}),t.jsx("div",{children:b(c.timestamp)})]}),c.speed!==void 0&&t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Speed:"}),t.jsx("div",{children:q(c.speed)})]}),c.accuracy&&t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Accuracy:"}),t.jsx("div",{children:x(c.accuracy)})]})]})]}),p&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h4",{className:"font-medium",children:["Order #",p.orderId]}),t.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${p.status==="DELIVERED"?"bg-green-100 text-green-800":p.status==="IN_TRANSIT"?"bg-blue-100 text-blue-800":p.status==="PICKED_UP"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:p.status.replace("_"," ")})]}),p.estimatedArrival&&t.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[t.jsx(G,{className:"h-4 w-4 mr-2"}),"Estimated arrival: ",b(p.estimatedArrival)]}),(d==null?void 0:d.role)==="DRIVER"&&e&&t.jsxs("div",{className:"flex space-x-2 pt-4 border-t",children:[t.jsx("button",{onClick:()=>k("PICKED_UP"),className:"flex-1 px-3 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 text-sm",children:"Mark Picked Up"}),t.jsx("button",{onClick:()=>k("DELIVERED"),className:"flex-1 px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700 text-sm",children:"Mark Delivered"})]}),t.jsxs("div",{className:"pt-4 border-t",children:[t.jsx("h5",{className:"font-medium mb-3",children:"Tracking History"}),t.jsx("div",{className:"space-y-3",children:p.trackingHistory.map((n,u)=>t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("div",{className:`w-3 h-3 rounded-full mt-1 ${n.status==="DELIVERED"?"bg-green-500":n.status==="IN_TRANSIT"?"bg-blue-500":n.status==="PICKED_UP"?"bg-yellow-500":"bg-gray-400"}`}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"font-medium text-sm",children:n.status.replace("_"," ")}),t.jsx("span",{className:"text-xs text-gray-500",children:b(n.timestamp)})]}),n.notes&&t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:n.notes}),n.location&&t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[n.location.latitude.toFixed(4),", ",n.location.longitude.toFixed(4)]})]})]},u))})]})]}),t.jsx("div",{className:"mt-6 pt-4 border-t",children:t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"text-gray-600",children:"Tracking Status:"}),t.jsxs("span",{className:`flex items-center ${g?"text-green-600":"text-gray-400"}`,children:[t.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${g?"bg-green-500":"bg-gray-400"}`}),g?"Active":"Inactive"]})]})})]})}function Re(){const[e,s]=l.useState([]),[r,i]=l.useState(""),[o,d]=l.useState(!0);l.useEffect(()=>{const m=[{id:"1",sender:"Ahmed (Driver)",content:"I am on my way to deliver your fuel order",timestamp:new Date(Date.now()-3e5).toISOString(),type:"received"},{id:"2",sender:"You",content:"Great! How long will it take?",timestamp:new Date(Date.now()-24e4).toISOString(),type:"sent"},{id:"3",sender:"Ahmed (Driver)",content:"About 15 minutes. I'm currently at Allen Avenue",timestamp:new Date(Date.now()-18e4).toISOString(),type:"received"}];s(m),d(!1)},[]);const g=()=>{if(!r.trim())return;const m={id:Date.now().toString(),sender:"You",content:r,timestamp:new Date().toISOString(),type:"sent"};s(c=>[...c,m]),i(""),setTimeout(()=>{const c={id:(Date.now()+1).toString(),sender:"Ahmed (Driver)",content:"Got it! Will update you shortly.",timestamp:new Date().toISOString(),type:"received"};s(N=>[...N,c])},2e3)};return o?t.jsx("div",{className:"p-4",children:"Loading chat..."}):t.jsxs(v,{className:"w-full h-96",children:[t.jsx(D,{className:"pb-3",children:t.jsxs(L,{className:"flex items-center gap-2",children:[t.jsx(ue,{className:"h-5 w-5"}),"Chat with Driver"]})}),t.jsxs(S,{className:"flex flex-col h-full",children:[t.jsx("div",{className:"flex-1 overflow-y-auto space-y-3 mb-4",children:e.map(m=>t.jsx("div",{className:`flex ${m.type==="sent"?"justify-end":"justify-start"}`,children:t.jsxs("div",{className:`max-w-xs rounded-lg p-3 ${m.type==="sent"?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"}`,children:[t.jsx("p",{className:"text-sm font-medium",children:m.sender}),t.jsx("p",{className:"text-sm",children:m.content}),t.jsx("p",{className:"text-xs opacity-75 mt-1",children:new Date(m.timestamp).toLocaleTimeString()})]})},m.id))}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(te,{value:r,onChange:m=>i(m.target.value),placeholder:"Type a message...",onKeyPress:m=>m.key==="Enter"&&g(),className:"flex-1"}),t.jsx(T,{onClick:g,size:"icon",children:t.jsx(he,{className:"h-4 w-4"})})]})]})]})}function qe(){const[,e]=se(),{user:s}=z(),[r,i]=l.useState("ORDER-123"),[o,d]=l.useState("order_123"),[g,m]=l.useState(!0),[c,N]=l.useState(null),[p,$]=l.useState([]),[_,w]=l.useState([]),[H,U]=l.useState(null),[O,J]=l.useState(null),[M,F]=l.useState(!1),{connected:j,emit:C}=ae();re();const{driverLocation:P,eta:k}=ie(r),{notifications:x,markAsRead:q}=ne(),[b,n]=l.useState(null);l.useEffect(()=>{const y={id:r,status:"IN_TRANSIT",customer:{id:1,name:"John Doe",phone:"+234 801 234 5678",address:"15 Victoria Island, Lagos"},merchant:{id:2,name:"TotalEnergies Station",phone:"+234 803 456 7890",address:"10 Lekki Phase 1, Lagos"},driver:{id:3,name:"Ahmed Musa",phone:"+234 805 678 9012",vehicle:"Toyota Hilux - ABC 123 XY"},items:[{name:"Premium Petrol",quantity:"20L",price:"₦8,000"}],totalAmount:"₦8,500",estimatedArrival:new Date(Date.now()+18e5).toISOString(),createdAt:new Date(Date.now()-18e5).toISOString()};N(y),$([y.customer,y.merchant,y.driver]),m(!1),j&&r&&C("subscribe_order_tracking",r)},[j,r,C]),l.useEffect(()=>{x.length>0&&!x[0].read&&n({id:x[0].id,title:x[0].title,message:x[0].message,type:x[0].type,timestamp:x[0].timestamp.getTime(),actions:[{label:"View Order",action:()=>e("/track-order"),variant:"default"}]})},[x,e]);const u=()=>{d("customer_driver_123")},f=()=>{d("customer_merchant_123")},R=()=>{var y;(y=c==null?void 0:c.driver)!=null&&y.phone&&(window.location.href=`tel:${c.driver.phone}`)},Y=y=>{switch(y){case"PENDING":return"bg-yellow-100 text-yellow-800";case"CONFIRMED":return"bg-blue-100 text-blue-800";case"IN_TRANSIT":return"bg-green-100 text-green-800";case"DELIVERED":return"bg-emerald-100 text-emerald-800";case"CANCELLED":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return g?t.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading real-time tracking..."})]})}):t.jsxs("div",{className:"min-h-screen bg-gray-50 pt-16 pb-20",children:[t.jsxs("div",{className:"max-w-md mx-auto p-4 space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[t.jsx(T,{variant:"ghost",size:"sm",onClick:()=>e("/consumer-home"),children:t.jsx(ce,{className:"h-4 w-4"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl font-bold",children:"Real-Time Tracking"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Live order and delivery updates"})]})]}),t.jsx(v,{className:"mb-4",children:t.jsx(S,{className:"p-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:`h-3 w-3 rounded-full ${j?"bg-green-500":"bg-red-500"} animate-pulse`}),t.jsx("span",{className:"text-sm font-medium",children:j?"Connected":"Disconnected"})]}),t.jsx(B,{variant:"outline",className:"text-xs",children:"Real-time"})]})})}),c&&t.jsxs(v,{className:"mb-4",children:[t.jsx(D,{className:"pb-2",children:t.jsxs(L,{className:"flex justify-between items-center text-base",children:[t.jsxs("span",{children:["Order ",c.id]}),t.jsx(B,{className:Y(c.status),children:c.status})]})}),t.jsx(S,{className:"pt-0",children:t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Driver:"}),t.jsx("span",{className:"font-medium",children:c.driver.name})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Vehicle:"}),t.jsx("span",{className:"font-medium",children:c.driver.vehicle})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"ETA:"}),t.jsx("span",{className:"font-medium text-green-600",children:k||"Calculating..."})]}),t.jsxs("div",{className:"flex gap-2 mt-3",children:[t.jsxs(T,{size:"sm",variant:"outline",onClick:R,className:"flex-1",children:[t.jsx(pe,{className:"h-4 w-4 mr-1"}),"Call"]}),t.jsxs(T,{size:"sm",onClick:u,className:"flex-1",children:[t.jsx(I,{className:"h-4 w-4 mr-1"}),"Chat"]})]})]})})]}),t.jsxs(oe,{defaultValue:"location",className:"w-full",children:[t.jsxs(le,{className:"grid w-full grid-cols-3",children:[t.jsxs(V,{value:"location",className:"text-xs",children:[t.jsx(K,{className:"h-4 w-4 mr-1"}),"Location"]}),t.jsxs(V,{value:"order",className:"text-xs",children:[t.jsx(de,{className:"h-4 w-4 mr-1"}),"Order"]}),t.jsxs(V,{value:"chat",className:"text-xs",children:[t.jsx(I,{className:"h-4 w-4 mr-1"}),"Chat"]})]}),t.jsxs(W,{value:"location",className:"mt-4 space-y-4",children:[t.jsx(ge,{driverLocation:P?{latitude:P.latitude,longitude:P.longitude}:void 0,customerLocation:c?{latitude:6.4281,longitude:3.4219}:void 0,orderId:r}),t.jsx(Ce,{}),t.jsx(v,{children:t.jsx(S,{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(G,{className:"h-5 w-5 text-blue-500"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium",children:"Estimated Arrival"}),t.jsx("p",{className:"text-sm text-gray-600",children:k||"Calculating route..."})]})]})})})]}),t.jsxs(W,{value:"order",className:"mt-4",children:[t.jsx(xe,{}),t.jsxs(v,{className:"mt-4",children:[t.jsx(D,{children:t.jsx(L,{className:"text-base",children:"Order Timeline"})}),t.jsx(S,{children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500 mt-2 flex-shrink-0"}),t.jsxs("div",{className:"text-sm",children:[t.jsx("p",{className:"font-medium",children:"Order Confirmed"}),t.jsx("p",{className:"text-gray-500 text-xs",children:new Date(c==null?void 0:c.createdAt).toLocaleString()})]})]}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-500 mt-2 flex-shrink-0"}),t.jsxs("div",{className:"text-sm",children:[t.jsx("p",{className:"font-medium",children:"Driver Assigned"}),t.jsxs("p",{className:"text-gray-500 text-xs",children:[c==null?void 0:c.driver.name," • ",c==null?void 0:c.driver.vehicle]})]})]}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"h-2 w-2 rounded-full bg-yellow-500 mt-2 flex-shrink-0 animate-pulse"}),t.jsxs("div",{className:"text-sm",children:[t.jsx("p",{className:"font-medium",children:"In Transit"}),t.jsx("p",{className:"text-gray-500 text-xs",children:"Currently delivering your order"})]})]})]})})]})]}),t.jsxs(W,{value:"chat",className:"mt-4",children:[t.jsx(Re,{}),t.jsxs(v,{className:"mt-4",children:[t.jsx(D,{children:t.jsx(L,{className:"text-base",children:"Quick Actions"})}),t.jsx(S,{children:t.jsxs("div",{className:"space-y-2",children:[t.jsxs(T,{variant:"outline",className:"w-full justify-start",onClick:f,children:[t.jsx(I,{className:"h-4 w-4 mr-2"}),"Chat with Merchant"]}),t.jsxs(T,{variant:"outline",className:"w-full justify-start",onClick:()=>e("/support"),children:[t.jsx(I,{className:"h-4 w-4 mr-2"}),"Contact Support"]})]})})]})]})]})]}),t.jsx(me,{notification:b,onClose:()=>{n(null),b&&q(b.id)}})]})}export{qe as default};
//# sourceMappingURL=real-time-tracking-BsCweB5J.js.map

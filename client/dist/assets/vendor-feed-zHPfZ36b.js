import{c as D,a as z,u as $,r as d,b as H,f as b,j as e,B as i,A as V,ab as B,aZ as Q,ac as K,ad as _,ae as W,I as h,af as G,m as J,s as Y,V as Z,g as A,n as X,y as k,$ as ee}from"./index-CVqmz7v7.js";import{A as se,b as ae,a as te}from"./avatar-aX6vUNG7.js";import{S as re,a as ie,b as ne,c as ce,d as le}from"./select-B0T04BLa.js";import{a as N}from"./queryClient-A1RmhH99.js";import{P as oe}from"./plus-CPiTij5A.js";import{C as de}from"./calendar-RsJxqlG8.js";import{H as E}from"./heart-LU7mhTdg.js";import"./check-Bv_Y_Lo5.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=D("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=D("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),g=[{value:"NEW_PRODUCT",label:"New Product",icon:"ðŸ†•"},{value:"PRODUCT_UPDATE",label:"Product Update",icon:"ðŸ”„"},{value:"PROMOTION",label:"Promotion",icon:"ðŸ·ï¸"},{value:"RESTOCK",label:"Restock Alert",icon:"ðŸ“¦"},{value:"ANNOUNCEMENT",label:"Announcement",icon:"ðŸ“¢"}];function fe(){const{user:r}=z(),[,f]=$(),[U,P]=d.useState(!1),[l,y]=d.useState("ALL"),p=H(),[a,o]=d.useState({title:"",content:"",postType:"ANNOUNCEMENT",tags:"",originalPrice:"",discountPrice:"",discountPercentage:"",validUntil:""}),v=b({mutationFn:s=>N("POST","/api/vendor-posts"),onSuccess:()=>{p.invalidateQueries({queryKey:["/api/vendor-posts"]}),P(!1),o({title:"",content:"",postType:"ANNOUNCEMENT",tags:"",originalPrice:"",discountPrice:"",discountPercentage:"",validUntil:""})}}),[w,T]=d.useState([]),[L,C]=d.useState(!0),[I,S]=d.useState(null);d.useEffect(()=>{(async()=>{try{C(!0),S(null);const t=new URLSearchParams;l!=="ALL"&&t.append("postType",l);const n=await fetch(`/api/vendor-posts?${t}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`,"Content-Type":"application/json"}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const c=await n.json();if(c.success)T(c.data||[]);else throw new Error(c.message||"Failed to fetch posts")}catch(t){console.error("Error fetching vendor posts:",t),S(t.message),T([])}finally{C(!1)}})()},[l]);const u=b({mutationFn:s=>N("POST","/api/cart",{userId:r==null?void 0:r.id,productId:s.productId,quantity:s.quantity}),onSuccess:()=>{p.invalidateQueries({queryKey:["/api/cart"]})}}),m=b({mutationFn:s=>N("POST","/api/wishlist",{userId:r==null?void 0:r.id}),onSuccess:()=>{p.invalidateQueries({queryKey:["/api/wishlist"]})}}),M=()=>{if(!r||!a.title||!a.content)return;const s={vendorId:r.id,title:a.title,content:a.content,postType:a.postType,tags:a.tags?a.tags.split(",").map(t=>t.trim()).filter(Boolean):[],...a.originalPrice&&{originalPrice:a.originalPrice},...a.discountPrice&&{discountPrice:a.discountPrice},...a.discountPercentage&&{discountPercentage:parseInt(a.discountPercentage)},...a.validUntil&&{validUntil:new Date(a.validUntil)}};v.mutate(s)},R=s=>{if(!s)return"";const t=typeof s=="string"?new Date(s):s;if(!(t instanceof Date)||isNaN(t.getTime()))return"Invalid Date";const c=Math.floor((new Date().getTime()-t.getTime())/1e3),x=Math.floor(c/60),j=Math.floor(x/60),O=Math.floor(j/24);return O>0?`${O}d ago`:j>0?`${j}h ago`:x>0?`${x}m ago`:"Just now"},F=s=>{const t=g.find(n=>n.value===s);return(t==null?void 0:t.icon)||"ðŸ“"},q=s=>{switch(s){case"NEW_PRODUCT":return"bg-green-100 text-green-800";case"PROMOTION":return"bg-red-100 text-red-800";case"RESTOCK":return"bg-blue-100 text-blue-800";case"PRODUCT_UPDATE":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"bg-white border-b sticky top-0 z-40",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>f("/dashboard"),children:e.jsx(V,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-xl font-semibold text-[#131313]",children:"Vendor Feed"})]}),(r==null?void 0:r.role)==="MERCHANT"&&e.jsxs(B,{open:U,onOpenChange:P,children:[e.jsx(Q,{asChild:!0,children:e.jsxs(i,{className:"bg-[#4682b4] hover:bg-[#0b1a51] text-white",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Create Post"]})}),e.jsxs(K,{className:"sm:max-w-md",children:[e.jsx(_,{children:e.jsx(W,{children:"Create New Post"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx(h,{placeholder:"Post title...",value:a.title,onChange:s=>o({...a,title:s.target.value})})}),e.jsx("div",{children:e.jsxs(re,{value:a.postType,onValueChange:s=>o({...a,postType:s}),children:[e.jsx(ie,{children:e.jsx(ne,{placeholder:"Select post type"})}),e.jsx(ce,{children:g.map(s=>e.jsxs(le,{value:s.value,children:[s.icon," ",s.label]},s.value))})]})}),e.jsx("div",{children:e.jsx(G,{placeholder:"What's happening with your business?",value:a.content,onChange:s=>o({...a,content:s.target.value}),rows:4})}),a.postType==="PROMOTION"&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(h,{placeholder:"Original price",type:"number",value:a.originalPrice,onChange:s=>o({...a,originalPrice:s.target.value})}),e.jsx(h,{placeholder:"Discount %",type:"number",value:a.discountPercentage,onChange:s=>o({...a,discountPercentage:s.target.value})})]}),e.jsx("div",{children:e.jsx(h,{placeholder:"Tags (comma separated)",value:a.tags,onChange:s=>o({...a,tags:s.target.value})})}),e.jsx(i,{onClick:M,disabled:v.isPending||!a.title||!a.content,className:"w-full bg-[#4682b4] hover:bg-[#0b1a51] text-white",children:v.isPending?"Creating...":"Create Post"})]})]})]})]}),e.jsx("div",{className:"px-4 pb-3",children:e.jsxs("div",{className:"flex space-x-2 overflow-x-auto",children:[e.jsx(i,{variant:l==="ALL"?"default":"outline",size:"sm",onClick:()=>y("ALL"),className:l==="ALL"?"bg-[#4682b4] hover:bg-[#0b1a51] text-white":"",children:"All Posts"}),g.map(s=>e.jsxs(i,{variant:l===s.value?"default":"outline",size:"sm",onClick:()=>y(s.value),className:l===s.value?"bg-[#4682b4] hover:bg-[#0b1a51] text-white":"",children:[s.icon," ",s.label]},s.value))]})})]}),e.jsx("div",{className:"p-4 space-y-4",children:L?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):I?e.jsxs("div",{className:"text-center py-8",children:[e.jsxs("p",{className:"text-red-600 mb-4",children:["Error loading posts: ",I]}),e.jsx(i,{onClick:()=>window.location.reload(),children:"Try Again"})]}):w.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No posts available"}):w.map(s=>{var t,n;return e.jsxs(J,{className:"hover:shadow-md transition-shadow",children:[e.jsx(Y,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(se,{className:"h-10 w-10",children:[e.jsx(ae,{src:s.vendorProfilePicture}),e.jsx(te,{className:"bg-[#4682b4] text-white",children:(t=s.vendorName)==null?void 0:t.charAt(0)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-[#131313]",children:s.vendorName}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[e.jsx(Z,{className:"h-3 w-3"}),e.jsx("span",{children:s.createdAt?R(s.createdAt):"Unknown"})]})]})]}),e.jsxs(A,{className:`${q(s.postType)} border-0`,children:[F(s.postType)," ",(n=g.find(c=>c.value===s.postType))==null?void 0:n.label]})]})}),e.jsxs(X,{className:"pt-0",children:[e.jsx("h3",{className:"font-semibold text-[#131313] mb-2",children:s.title}),e.jsx("p",{className:"text-gray-700 mb-3 whitespace-pre-wrap",children:s.content}),s.postType==="PROMOTION"&&(s.originalPrice||s.discountPercentage)&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(xe,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"font-medium text-red-800",children:"Special Offer"})]}),s.originalPrice&&e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"text-gray-500 line-through",children:["â‚¦",parseFloat(s.originalPrice).toLocaleString()]}),s.discountPercentage&&e.jsxs("span",{className:"ml-2 text-red-600 font-bold",children:[s.discountPercentage,"% OFF"]})]}),s.validUntil&&e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-red-600 mt-1",children:[e.jsx(de,{className:"h-3 w-3"}),e.jsxs("span",{children:["Valid until ",new Date(s.validUntil).toLocaleDateString()]})]})]}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(ue,{className:"h-3 w-3 text-gray-400"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.tags.map((c,x)=>e.jsx(A,{variant:"secondary",className:"text-xs",children:c},x))})]}),s.productName&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-[#131313]",children:s.productName}),s.productPrice&&e.jsxs("p",{className:"text-[#4682b4] font-bold",children:["â‚¦",parseFloat(s.productPrice).toLocaleString()]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(i,{size:"sm",onClick:()=>u.mutate({productId:s.productId,quantity:1}),className:"bg-[#4682b4] hover:bg-[#0b1a51] text-white",disabled:u.isPending,children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),"Cart"]}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>m.mutate(s.productId),className:"border-[#4682b4] text-[#4682b4] hover:bg-[#4682b4] hover:text-white",disabled:m.isPending,children:e.jsx(E,{className:"h-3 w-3"})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>{s.productId&&u.mutate({productId:s.productId,quantity:1})},className:"flex items-center space-x-1 border-[#4682b4] text-[#4682b4] hover:bg-[#4682b4] hover:text-white",disabled:!s.productId||u.isPending,children:[e.jsx(k,{className:"h-3 w-3"}),e.jsx("span",{children:"Add to Cart"})]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>{f(`/chat?vendorId=${s.vendorId}&productId=${s.productId}&type=QUOTE`)},className:"flex items-center space-x-1 border-gray-300 text-gray-600 hover:bg-gray-50",children:[e.jsx(ee,{className:"h-3 w-3"}),e.jsx("span",{children:"Quote"})]})]}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>{s.productId&&m.mutate(s.productId)},className:"text-gray-600 hover:text-red-500",disabled:!s.productId||m.isPending,children:e.jsx(E,{className:"h-4 w-4"})})]})]})]},s.id)})})]})}export{fe as default};
//# sourceMappingURL=vendor-feed-zHPfZ36b.js.map

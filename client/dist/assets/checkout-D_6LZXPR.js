import{r as m,j as e,a7 as O,u as $,a as z,a8 as K,b as Q,e as A,f as V,B as y,A as M,m as d,s as f,V as U,n as o,t as w,k as H,I as C,a1 as W,a3 as J}from"./index-CVqmz7v7.js";import{L as x}from"./label-FpSljPAT.js";import{a as X}from"./queryClient-A1RmhH99.js";import{B as Z}from"./building-2-13LR0Zo0.js";const T=m.forwardRef(({value:i,onValueChange:a,children:l,className:h,...c},u)=>e.jsx("div",{ref:u,role:"radiogroup",className:O("grid gap-2",h),...c,children:l}));T.displayName="RadioGroup";const N=m.forwardRef(({value:i,id:a,className:l,disabled:h=!1,...c},u)=>e.jsx("button",{ref:u,type:"button",role:"radio","aria-checked":!1,"data-state":"unchecked",value:i,className:O("aspect-square h-4 w-4 rounded-full border border-gray-300 text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",l),id:a,disabled:h,...c,children:e.jsx("span",{className:"flex items-center justify-center",children:e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-current"})})}));N.displayName="RadioGroupItem";function re(){const[,i]=$(),{user:a}=z(),{toast:l}=K(),h=Q(),[c,u]=m.useState("card"),[p,D]=m.useState(""),[k,G]=m.useState(""),[F,R]=m.useState(""),[I,P]=m.useState(!1),{data:b=[],isLoading:L}=A({queryKey:["/api/cart",a==null?void 0:a.id],enabled:!!(a!=null&&a.id),queryFn:async()=>{const t=await(await fetch(`/api/cart/${a==null?void 0:a.id}`)).json();return t.success?t.cartItems:[]}}),{data:_=[]}=A({queryKey:["/api/payment-methods",a==null?void 0:a.id],enabled:!!(a!=null&&a.id),queryFn:async()=>{const t=await(await fetch(`/api/payment-methods/${a==null?void 0:a.id}`)).json();return t.success?t.paymentMethods:[]}}),j=b.reduce((s,t)=>{const r=s.find(Y=>Y.sellerId===t.sellerId);return r?(r.items.push(t),r.subtotal+=t.price*t.quantity):s.push({sellerId:t.sellerId||0,sellerName:t.sellerName||"Unknown Merchant",items:[t],subtotal:t.price*t.quantity,estimatedDeliveryTime:"30-45 mins"}),s},[]),v=j.reduce((s,t)=>s+t.subtotal,0),S=j.length*500,q=v*.02,g=v+S+q,B=V({mutationFn:async s=>X("POST","/api/orders"),onSuccess:s=>{h.invalidateQueries({queryKey:["/api/cart",a==null?void 0:a.id]}),l({title:"Order Placed Successfully!",description:"Your order has been confirmed and moved to escrow. You'll receive updates shortly."}),i(`/order-confirmation/${s.orderId}`)},onError:s=>{l({variant:"destructive",title:"Order Failed",description:s.message||"Failed to place order. Please try again."})}}),E=async()=>{if(!p.trim()){l({variant:"destructive",title:"Missing Information",description:"Please provide a delivery address."});return}if(b.length===0){l({variant:"destructive",title:"Empty Cart",description:"Add items to your cart before checkout."});return}P(!0);try{const s=j.map(t=>({items:t.items,sellerId:t.sellerId,deliveryAddress:p,paymentMethod:c,orderNotes:k,promoCode:F||null,subtotal:t.subtotal,deliveryFee:500,serviceFee:t.subtotal*.02}));await B.mutateAsync({orders:s,totalAmount:g,paymentMethod:c})}catch(s){console.error("Checkout error:",s)}finally{P(!1)}},n=s=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN",minimumFractionDigits:0}).format(s);return L?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading checkout..."})]})}):b.length===0?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 px-4 py-3 flex items-center",children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>i("/commodities"),className:"mr-3 p-2",children:e.jsx(M,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Checkout"})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"Your cart is empty"}),e.jsx(y,{onClick:()=>i("/commodities"),children:"Continue Shopping"})]})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 px-4 py-3 flex items-center sticky top-0 z-10",children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>i("/cart"),className:"mr-3 p-2",children:e.jsx(M,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Checkout"})]}),e.jsxs("div",{className:"max-w-2xl mx-auto p-4 space-y-6",children:[j.map((s,t)=>e.jsxs(d,{className:"overflow-hidden",children:[e.jsx(f,{className:"bg-gray-50 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"h-4 w-4 text-gray-600"}),e.jsx("h3",{className:"font-medium text-gray-900",children:s.sellerName})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx("span",{children:s.estimatedDeliveryTime})]})]})}),e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[s.items.map(r=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:r.productName}),e.jsxs("p",{className:"text-sm text-gray-600",children:[n(r.price)," Ã— ",r.quantity," ",r.productUnit]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-medium",children:n(r.price*r.quantity)})})]},r.productId)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between items-center font-medium",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:n(s.subtotal)})]})})]})})]},s.sellerId)),e.jsxs(d,{children:[e.jsx(f,{children:e.jsxs(w,{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"h-5 w-5"}),e.jsx("span",{children:"Delivery Address"})]})}),e.jsxs(o,{children:[e.jsx(x,{htmlFor:"address",children:"Address"}),e.jsx(C,{id:"address",placeholder:"Enter your full delivery address",value:p,onChange:s=>D(s.target.value),className:"mt-1"})]})]}),e.jsxs(d,{children:[e.jsx(f,{children:e.jsxs(w,{className:"flex items-center space-x-2",children:[e.jsx(W,{className:"h-5 w-5"}),e.jsx("span",{children:"Payment Method"})]})}),e.jsx(o,{children:e.jsxs(T,{value:c,onValueChange:u,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{value:"card",id:"card"}),e.jsx(x,{htmlFor:"card",children:"Credit/Debit Card"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{value:"bank",id:"bank"}),e.jsx(x,{htmlFor:"bank",children:"Bank Transfer"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{value:"wallet",id:"wallet"}),e.jsx(x,{htmlFor:"wallet",children:"Wallet Balance"})]})]})})]}),e.jsx(d,{children:e.jsxs(o,{className:"pt-6",children:[e.jsx(x,{htmlFor:"promo",children:"Promo Code (Optional)"}),e.jsx(C,{id:"promo",placeholder:"Enter promo code",value:F,onChange:s=>R(s.target.value),className:"mt-1"})]})}),e.jsx(d,{children:e.jsxs(o,{className:"pt-6",children:[e.jsx(x,{htmlFor:"notes",children:"Order Notes (Optional)"}),e.jsx(C,{id:"notes",placeholder:"Any special instructions...",value:k,onChange:s=>G(s.target.value),className:"mt-1"})]})}),e.jsxs(d,{children:[e.jsx(f,{children:e.jsx(w,{children:"Order Summary"})}),e.jsxs(o,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Items Total"}),e.jsx("span",{children:n(v)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Delivery Fee"}),e.jsx("span",{children:n(S)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Service Fee"}),e.jsx("span",{children:n(q)})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:n(g)})]})]})]}),e.jsx(d,{className:"border-blue-200 bg-blue-50",children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(J,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Secure Payment"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Your payment will be held in escrow until delivery is confirmed. Funds are automatically released after 7 days or when you confirm receipt."})]})]})})}),e.jsx(y,{onClick:E,disabled:I||!p.trim(),className:"w-full h-12 text-lg font-medium",children:I?"Processing...":`Place Order - ${n(g)}`})]})]})}export{re as default};
//# sourceMappingURL=checkout-D_6LZXPR.js.map

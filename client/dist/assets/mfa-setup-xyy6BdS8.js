import{c as F,a as q,a8 as $,u as z,r as a,j as e,a3 as K,m as u,s as p,t as j,n as f,g as R,I as S,h as J,B as i,C as G,a9 as H,D as W}from"./index-CVqmz7v7.js";import{L as w}from"./label-FpSljPAT.js";import{Q as X}from"./qr-code-BNXnmlXa.js";import{S as Z}from"./smartphone-Bz4ZH1hb.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=F("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=F("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),n={PRIMARY:"#4682b4",SECONDARY:"#131313"};function le(){const{user:se}=q(),{toast:l}=$(),[,T]=z(),[b,E]=a.useState(null),[t,y]=a.useState(""),[g,L]=a.useState(""),[N,O]=a.useState(""),[k,P]=a.useState(""),[M,I]=a.useState(""),[v,V]=a.useState([]),[o,B]=a.useState(""),[d,m]=a.useState(!1),[x,h]=a.useState("select");a.useEffect(()=>{A()},[]);const A=async()=>{try{const s=await fetch("/api/mfa/status",{credentials:"include"});if(s.ok){const c=await s.json();E(c.mfa),c.mfa.enabled&&h("complete")}}catch(s){console.error("Failed to fetch MFA status:",s)}},Y=async()=>{if(t){m(!0);try{const s={method:t};t==="SMS"&&g?s.phoneNumber=g:t==="EMAIL"&&N&&(s.email=N);const r=await(await fetch("/api/mfa/setup",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();if(r.success)t==="TOTP"&&(P(r.qrCode),I(r.secret)),V(r.backupCodes||[]),h("verify"),l({title:"MFA Setup Started",description:`${t} MFA has been configured`,variant:"default"});else throw new Error(r.message)}catch(s){l({title:"Setup Failed",description:s.message||"Failed to setup MFA",variant:"destructive"})}finally{m(!1)}}},D=async()=>{if(!o){l({title:"Token Required",description:"Please enter the verification token",variant:"destructive"});return}m(!0);try{const c=await(await fetch("/api/mfa/verify",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:o,method:t,rememberDevice:!1})})).json();if(c.success)h("complete"),A(),l({title:"MFA Verified",description:"Multi-factor authentication is now active",variant:"default"});else throw new Error(c.message)}catch(s){l({title:"Verification Failed",description:s.message||"Invalid verification token",variant:"destructive"})}finally{m(!1)}},Q=s=>{navigator.clipboard.writeText(s),l({title:"Copied",description:"Copied to clipboard",variant:"default"})},U=()=>{const s=v.join(`
`),c=new Blob([s],{type:"text/plain"}),r=URL.createObjectURL(c),C=document.createElement("a");C.href=r,C.download="mfa-backup-codes.txt",C.click(),URL.revokeObjectURL(r)};return b?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-white p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(K,{className:"h-16 w-16 mx-auto text-blue-600 mb-4"}),e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:n.SECONDARY},children:"Multi-Factor Authentication"}),e.jsx("p",{className:"text-gray-600",children:"Add an extra layer of security to your account"})]}),x==="select"&&e.jsxs(u,{children:[e.jsx(p,{children:e.jsx(j,{children:"Choose MFA Method"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsx("div",{className:`border-2 rounded-xl p-4 cursor-pointer transition-all ${t==="TOTP"?"border-blue-500 bg-blue-50":"border-gray-200"}`,onClick:()=>y("TOTP"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"h-8 w-8 text-blue-600 mr-4"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Authenticator App"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Use Google Authenticator, Authy, or similar apps"}),e.jsx(R,{className:"mt-1 bg-green-100 text-green-800",children:"Recommended"})]})]})}),e.jsxs("div",{className:`border-2 rounded-xl p-4 cursor-pointer transition-all ${t==="SMS"?"border-blue-500 bg-blue-50":"border-gray-200"}`,onClick:()=>y("SMS"),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{className:"h-8 w-8 text-blue-600 mr-4"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"SMS Text Message"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Receive codes via text message"})]})]}),t==="SMS"&&e.jsxs("div",{className:"mt-4",children:[e.jsx(w,{htmlFor:"phone",children:"Phone Number"}),e.jsx(S,{id:"phone",value:g,onChange:s=>L(s.target.value),placeholder:"+234xxxxxxxxxx",className:"rounded-xl"})]})]}),e.jsxs("div",{className:`border-2 rounded-xl p-4 cursor-pointer transition-all ${t==="EMAIL"?"border-blue-500 bg-blue-50":"border-gray-200"}`,onClick:()=>y("EMAIL"),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(J,{className:"h-8 w-8 text-blue-600 mr-4"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Email Verification"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Receive codes via email"})]})]}),t==="EMAIL"&&e.jsxs("div",{className:"mt-4",children:[e.jsx(w,{htmlFor:"email",children:"Email Address"}),e.jsx(S,{id:"email",type:"email",value:N,onChange:s=>O(s.target.value),placeholder:"your@email.com",className:"rounded-xl"})]})]}),e.jsx(i,{onClick:Y,disabled:d||!t,className:"w-full rounded-xl",style:{backgroundColor:n.PRIMARY},children:d?"Setting up...":"Continue Setup"})]})]}),x==="setup"&&t==="TOTP"&&k&&e.jsxs(u,{children:[e.jsx(p,{children:e.jsx(j,{children:"Scan QR Code"})}),e.jsxs(f,{className:"text-center space-y-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-xl inline-block",children:e.jsx("img",{src:k,alt:"QR Code",className:"w-48 h-48"})}),e.jsxs("div",{className:"text-left space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Manual Setup Key:"}),e.jsxs("div",{className:"flex items-center space-x-2 bg-gray-100 p-3 rounded-lg",children:[e.jsx("code",{className:"flex-1 text-sm",children:M}),e.jsx(i,{size:"sm",variant:"outline",onClick:()=>Q(M),children:e.jsx(_,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-2",children:[e.jsx("p",{children:"1. Open your authenticator app"}),e.jsx("p",{children:"2. Scan the QR code or enter the manual key"}),e.jsx("p",{children:"3. Enter the 6-digit code from your app below"})]}),e.jsx(i,{onClick:()=>h("verify"),className:"w-full rounded-xl",style:{backgroundColor:n.PRIMARY},children:"I've Added the Account"})]})]}),x==="verify"&&e.jsxs(u,{children:[e.jsx(p,{children:e.jsx(j,{children:"Verify Setup"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{className:"h-16 w-16 mx-auto text-blue-600 mb-4"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["Enter the verification code from your ",t.toLowerCase()]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"token",children:"Verification Code"}),e.jsx(S,{id:"token",value:o,onChange:s=>B(s.target.value),placeholder:"Enter 6-digit code",className:"rounded-xl text-center text-2xl tracking-widest",maxLength:6})]}),e.jsx(i,{onClick:D,disabled:d||o.length!==6,className:"w-full rounded-xl",style:{backgroundColor:n.PRIMARY},children:d?"Verifying...":"Verify & Enable MFA"})]})]}),x==="complete"&&e.jsxs(u,{children:[e.jsx(p,{children:e.jsxs(j,{className:"flex items-center text-green-600",children:[e.jsx(G,{className:"h-6 w-6 mr-2"}),"MFA Enabled Successfully"]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Your account is now protected with multi-factor authentication"}),b.method&&e.jsxs(R,{className:"bg-green-100 text-green-800",children:["Method: ",b.method]})]}),v.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(H,{className:"h-5 w-5 text-yellow-600 mr-2"}),e.jsx("h3",{className:"font-semibold text-yellow-800",children:"Backup Codes"})]}),e.jsx("p",{className:"text-sm text-yellow-700 mb-3",children:"Save these backup codes in a secure place. You can use them to access your account if you lose access to your MFA device."}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:v.slice(0,6).map((s,c)=>e.jsx("code",{className:"bg-white p-2 rounded text-sm text-center",children:s},c))}),e.jsxs(i,{onClick:U,variant:"outline",size:"sm",className:"w-full",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Download Backup Codes"]})]}),e.jsx(i,{onClick:()=>T("/account-settings"),className:"w-full rounded-xl",style:{backgroundColor:n.PRIMARY},children:"Return to Account Settings"})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-white p-4 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})})}export{le as default};
//# sourceMappingURL=mfa-setup-xyy6BdS8.js.map

import{c as M,r,j as e,m as v,n as j,a9 as T,B as f,a3 as U,C as F,u as P,A as K,K as N}from"./index-CVqmz7v7.js";import{F as O}from"./fingerprint-DRUXPWYM.js";import{s as I,e as q}from"./confirmation_fail_img-l7dZ-eC2.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=M("Scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);function z({onSuccess:c,onError:x,onCancel:s,mode:n="setup",title:u,description:b}){const[l,o]=r.useState({available:!1,types:[]}),[m,h]=r.useState(!1),[y,p]=r.useState(null);r.useEffect(()=>{g()},[]);const g=async()=>{try{if(!window.PublicKeyCredential){o({available:!1,types:[],errorMessage:"Biometric authentication not supported on this device"});return}if(!await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()){o({available:!1,types:[],errorMessage:"No biometric authenticator available"});return}const a=[];navigator.userAgent.includes("iPhone")||navigator.userAgent.includes("iPad")?(a.push("face"),navigator.userAgent.includes("iPhone")&&a.push("fingerprint")):navigator.userAgent.includes("Android")?(a.push("fingerprint"),a.push("face")):a.push("fingerprint"),o({available:!0,types:a})}catch(t){console.error("Error checking biometric capabilities:",t),o({available:!1,types:[],errorMessage:"Error checking biometric support"})}},w=async t=>{h(!0),p(t);try{const a=await A(),i={challenge:a,allowCredentials:n==="authenticate"?await C():[],userVerification:"required",timeout:6e4};n==="setup"?await d(t,a):await S(i),c(t)}catch(a){console.error("Biometric authentication error:",a);let i="Biometric authentication failed";a.name==="NotAllowedError"?i="Biometric authentication was cancelled or not allowed":a.name==="SecurityError"?i="Security error during biometric authentication":a.name==="AbortError"?i="Biometric authentication was aborted":a.name==="NotSupportedError"&&(i="Biometric authentication not supported"),x(i)}finally{h(!1),p(null)}},d=async(t,a)=>{const i={challenge:a,rp:{name:"BrillPrime",id:window.location.hostname},user:{id:new TextEncoder().encode("user-id"),name:"user@example.com",displayName:"User Name"},pubKeyCredParams:[{alg:-7,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required",requireResidentKey:!0},timeout:6e4,attestation:"direct"},k=await navigator.credentials.create({publicKey:i});await B(k,t)},S=async t=>{const a=await navigator.credentials.get({publicKey:t});await E(a)},A=async()=>{const t=await fetch("/api/auth/biometric/challenge",{method:"POST",credentials:"include"});if(!t.ok)throw new Error("Failed to generate challenge");const{challenge:a}=await t.json();return new Uint8Array(a).buffer},C=async()=>{const t=await fetch("/api/auth/biometric/credentials",{credentials:"include"});if(!t.ok)throw new Error("Failed to get stored credentials");const{credentials:a}=await t.json();return a},B=async(t,a)=>{if(!(await fetch("/api/auth/biometric/store",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({credentialId:Array.from(new Uint8Array(t.rawId)),publicKey:Array.from(new Uint8Array(t.response.publicKey)),type:a})})).ok)throw new Error("Failed to store credential")},E=async t=>{if(!(await fetch("/api/auth/biometric/verify",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({credentialId:Array.from(new Uint8Array(t.rawId)),authenticatorData:Array.from(new Uint8Array(t.response.authenticatorData)),signature:Array.from(new Uint8Array(t.response.signature)),clientDataJSON:Array.from(new Uint8Array(t.response.clientDataJSON))})})).ok)throw new Error("Failed to verify credential")};return l.available?e.jsx(v,{className:"w-full max-w-md mx-auto",children:e.jsxs(j,{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(U,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:u||(n==="setup"?"Setup Biometric Authentication":"Biometric Authentication")}),e.jsx("p",{className:"text-gray-600",children:b||"Choose your preferred biometric authentication method for secure access to your account"})]}),e.jsx("div",{className:"space-y-4",children:l.types.map(t=>e.jsxs(f,{variant:"outline",size:"lg",className:"w-full h-16 flex items-center justify-start space-x-4 p-4 hover:bg-blue-50 border-2 hover:border-blue-300",onClick:()=>w(t),disabled:m,children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[t==="fingerprint"?e.jsx(O,{className:"w-8 h-8 text-blue-600"}):e.jsx(D,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold",children:t==="fingerprint"?"Fingerprint":"Face Recognition"}),e.jsx("div",{className:"text-sm text-gray-500",children:t==="fingerprint"?"Use your fingerprint to authenticate":"Use your face to authenticate"})]})]}),m&&y===t&&e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"})})]},t))}),n==="setup"&&e.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(F,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Security Features:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Your biometric data stays on your device"}),e.jsx("li",{children:"End-to-end encrypted authentication"}),e.jsx("li",{children:"Can be disabled anytime in settings"})]})]})]})}),s&&e.jsx("div",{className:"mt-6 text-center",children:e.jsx(f,{variant:"ghost",onClick:s,children:n==="setup"?"Skip for Now":"Use Password Instead"})})]})}):e.jsx(v,{className:"w-full max-w-md mx-auto",children:e.jsxs(j,{className:"p-6 text-center",children:[e.jsx(T,{className:"w-12 h-12 text-amber-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Biometric Authentication Unavailable"}),e.jsx("p",{className:"text-gray-600 mb-4",children:l.errorMessage||"Your device does not support biometric authentication"}),s&&e.jsx(f,{variant:"outline",onClick:s,children:"Continue without Biometrics"})]})})}function V(){const[,c]=P(),[x,s]=r.useState(!1),[n,u]=r.useState(!1),[b,l]=r.useState(""),[o,m]=r.useState(""),h=d=>{m(d==="fingerprint"?"Fingerprint":"Face ID"),s(!0)},y=d=>{l(d),u(!0)},p=()=>{c("/dashboard")},g=()=>{s(!1),c("/dashboard")},w=()=>{u(!1)};return e.jsxs("div",{className:"w-full max-w-md mx-auto min-h-screen bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 pt-12",children:[e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>c("/profile"),className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(K,{className:"w-5 h-5 text-[var(--brill-text)]"})}),e.jsx("h1",{className:"text-lg font-bold text-[var(--brill-text)]",children:"Biometric Setup"}),e.jsx("div",{className:"w-9"})]}),e.jsx("div",{className:"px-6 py-8",children:e.jsx(z,{onSuccess:h,onError:y,onCancel:p})}),e.jsx(N,{isOpen:x,onClose:g,type:"success",title:"Biometric Setup Complete!",message:`${o} authentication has been successfully enabled for your account. You can now use it to sign in quickly and securely.`,imageSrc:I,buttonText:"Continue"}),e.jsx(N,{isOpen:n,onClose:w,type:"error",title:"Setup Failed",message:b,imageSrc:q,buttonText:"Try Again"})]})}export{V as default};
//# sourceMappingURL=biometric-setup-DE2AAkmv.js.map

import{u as b,J as w,H as L,r as i,j as e,B as c,A as k,m as n,n as l,g as C,V as E,$ as D,C as O}from"./index-CPIh2kaR.js";import{L as T}from"./live-map-DXBjH6ZS.js";import{P as R}from"./phone-2OSRHZsq.js";function U(){const[,d]=b(),{connected:m,driverLocations:x,etaUpdates:u,subscribeToDriverTracking:j}=w(),{orderUpdates:h}=L(),[s,o]=i.useState(null),[g,N]=i.useState(!0),r=window.location.pathname.split("/").pop();i.useEffect(()=>{(async()=>{if(r)try{const a=await fetch(`/api/tracking/order/${r}`,{credentials:"include"});if(a.ok){const y=await a.json();o(y.tracking)}else console.error("Failed to fetch order tracking data")}catch(a){console.error("Error fetching order tracking:",a)}finally{N(!1)}})()},[r]),i.useEffect(()=>{m&&r&&j(r)},[m,r,j]),i.useEffect(()=>{if(s&&x[s.id]){const t=x[s.id];o(a=>a?{...a,currentLocation:{latitude:t.location.lat,longitude:t.location.lng},estimatedArrival:t.eta||a.estimatedArrival}:null)}},[x,s]),i.useEffect(()=>{if(h[r||""]&&s){const t=h[r||""];o(a=>a?{...a,status:t.status}:null)}},[h,r,s]),i.useEffect(()=>{if(u[r||""]&&s){const t=u[r||""];o(a=>a?{...a,estimatedArrival:t.eta||a.estimatedArrival}:null)}},[u,r,s]);const p=t=>{switch(t){case"CONFIRMED":return"bg-blue-100 text-blue-800";case"PREPARING":return"bg-yellow-100 text-yellow-800";case"OUT_FOR_DELIVERY":return"bg-orange-100 text-orange-800";case"DELIVERED":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},v=t=>t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});if(g)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading order tracking..."})]})});if(!s)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Order not found"}),e.jsx(c,{onClick:()=>d("/order-history"),className:"mt-4",children:"View Order History"})]})});const f=[{lat:s.deliveryLatitude,lng:s.deliveryLongitude,title:"Delivery Location",type:"delivery"}];return s.currentLocation&&f.push({lat:s.currentLocation.latitude,lng:s.currentLocation.longitude,title:`Driver: ${s.driverName}`,type:"delivery"}),e.jsxs("div",{className:"min-h-screen bg-gray-50 w-full max-w-md mx-auto",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>d("/order-history"),children:e.jsx(k,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-lg font-semibold text-[#131313]",children:"Track Order"}),e.jsx("div",{className:"w-10"})]})}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx(n,{children:e.jsxs(l,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-semibold text-[#131313]",children:["Order #",s.id.slice(-6)]}),e.jsx(C,{className:p(s.status),children:s.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsxs("span",{children:["Estimated arrival: ",s.estimatedArrival]})]}),m&&e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-green-600 mt-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Live tracking active"})]})]})}),e.jsx(n,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-[#131313] mb-3",children:"Live Location"}),e.jsx("div",{className:"h-64 rounded-lg overflow-hidden",children:e.jsx(T,{showUserLocation:!1,showNearbyUsers:!1,className:"w-full h-full",userRole:"CONSUMER",center:s.currentLocation?{lat:s.currentLocation.latitude,lng:s.currentLocation.longitude}:{lat:s.deliveryLatitude,lng:s.deliveryLongitude},markers:f,showRoute:s.currentLocation?{start:{lat:s.currentLocation.latitude,lng:s.currentLocation.longitude},end:{lat:s.deliveryLatitude,lng:s.deliveryLongitude}}:void 0})})]})}),e.jsx(n,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-[#131313] mb-3",children:"Your Driver"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-[#4682b4] rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-medium",children:s.driverName.charAt(0)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-[#131313]",children:s.driverName}),e.jsx("p",{className:"text-sm text-gray-600",children:"Fuel Delivery Driver"}),e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-green-600",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{children:"Live tracking"})]})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(c,{variant:"outline",size:"icon",onClick:()=>window.location.href=`tel:${s.driverPhone}`,children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx(c,{variant:"outline",size:"icon",onClick:()=>d(`/chat/driver/${s.id}`),children:e.jsx(D,{className:"w-4 h-4"})})]})]})]})}),e.jsx(n,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-[#131313] mb-4",children:"Order Timeline"}),e.jsx("div",{className:"space-y-4",children:s.timeline.map((t,a)=>e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${t.completed?"bg-green-500":"bg-gray-300"}`,children:t.completed?e.jsx(O,{className:"w-4 h-4 text-white"}):e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-medium ${t.completed?"text-[#131313]":"text-gray-400"}`,children:t.message}),e.jsx("p",{className:"text-xs text-gray-500",children:v(t.timestamp)})]})]},a))})]})}),e.jsx(n,{children:e.jsxs(l,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-[#131313] mb-3",children:"Order Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Fuel Type"}),e.jsx("span",{className:"font-medium",children:s.fuelType})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Quantity"}),e.jsxs("span",{className:"font-medium",children:[s.quantity,"L"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Pickup"}),e.jsx("span",{className:"font-medium text-right",children:s.pickupLocation})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Delivery"}),e.jsx("span",{className:"font-medium text-right",children:s.deliveryLocation})]})]})]})}),e.jsx(n,{className:"border-red-200",children:e.jsxs(l,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-red-600 mb-2",children:"Need Help?"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"If you have any issues with your delivery, contact our support team."}),e.jsx(c,{variant:"outline",className:"w-full border-red-200 text-red-600 hover:bg-red-50",onClick:()=>d("/support"),children:"Contact Support"})]})})]})]})}export{U as default};
//# sourceMappingURL=track-order-GDqNhScA.js.map

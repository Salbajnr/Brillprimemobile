import{c as p,a as W,r as n,W as J,j as e,g as K,B as h,k as G,I as H,ah as L,V as Q}from"./index-CVqmz7v7.js";import{A as M,b as R,a as A}from"./avatar-aX6vUNG7.js";import{P as X}from"./phone-0BJ47FE1.js";import{S as D}from"./send-KLPsBBjB.js";import{C as Y}from"./check-Bv_Y_Lo5.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=p("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=p("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=p("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=p("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);function ne(){var I,C,E,S,T;const{user:a}=W(),[P,m]=n.useState([]),[t,j]=n.useState(null),[x,u]=n.useState(""),[y,g]=n.useState(!1),[V,ae]=n.useState([]),[O,$]=n.useState(!0),N=n.useRef(null),z=n.useRef(null),f=n.useRef(),{socket:d,isConnected:v}=J(),U=async()=>{try{const s=await fetch("/api/chat/sessions",{credentials:"include"});if(!s.ok)throw new Error("Failed to load chat sessions");const i=await s.json();m(i.sessions||[]);const r=i.sessions.filter(l=>l.status==="active");r.length>0&&(j(r[0]),b(r[0].id))}catch(s){console.error("Error loading chat sessions:",s),L({title:"Error",description:"Failed to load chat sessions",variant:"destructive"})}finally{$(!1)}},b=async s=>{try{const i=await fetch(`/api/chat/messages/${s}`,{credentials:"include"});if(!i.ok)throw new Error("Failed to load messages");const r=await i.json();m(l=>l.map(c=>c.id===s?{...c,messages:r.messages||[]}:c))}catch(i){console.error("Error loading messages:",i)}},w=async()=>{if(!x.trim()||!t||!d)return;const s={id:"temp_"+Date.now(),senderId:(a==null?void 0:a.id)||"",senderName:(a==null?void 0:a.firstName)+" "+(a==null?void 0:a.lastName)||"",senderRole:(a==null?void 0:a.role)||"",message:x.trim(),timestamp:Date.now(),type:"text",status:"sending"};m(i=>i.map(r=>r.id===t.id?{...r,messages:[...r.messages,s]}:r));try{const i=await fetch("/api/chat/send-message",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({chatId:t.id,message:x.trim(),type:"text",orderId:t.orderId})});if(!i.ok)throw new Error("Failed to send message");const r=await i.json();m(l=>l.map(c=>c.id===t.id?{...c,messages:c.messages.map(o=>o.id===s.id?{...o,id:r.messageId,status:"sent"}:o)}:c)),u(""),g(!1)}catch(i){console.error("Error sending message:",i),m(r=>r.map(l=>l.id===t.id?{...l,messages:l.messages.map(c=>c.id===s.id?{...c,status:"sent"}:c)}:l)),L({title:"Error",description:"Failed to send message",variant:"destructive"})}},_=n.useCallback(()=>{!t||!d||(y||(g(!0),d.emit("typing_start",{chatId:t.id,userId:a==null?void 0:a.id,userName:(a==null?void 0:a.firstName)+" "+(a==null?void 0:a.lastName)})),f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{g(!1),d.emit("typing_stop",{chatId:t.id,userId:a==null?void 0:a.id})},2e3))},[t,d,a,y]),B=()=>{var s;(s=N.current)==null||s.scrollIntoView({behavior:"smooth"})},k=s=>new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),q=s=>{switch(s){case"sending":return e.jsx(Q,{className:"h-3 w-3 text-gray-400"});case"sent":return e.jsx(Y,{className:"h-3 w-3 text-gray-400"});case"delivered":return e.jsx(F,{className:"h-3 w-3 text-gray-400"});case"read":return e.jsx(F,{className:"h-3 w-3 text-blue-500"});default:return null}};return n.useEffect(()=>{U()},[]),n.useEffect(()=>{B()},[t==null?void 0:t.messages]),n.useEffect(()=>{if(t&&d)return d.emit("join_chat",{chatId:t.id}),()=>{d.emit("leave_chat",{chatId:t.id})}},[t,d]),O?e.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-96 bg-gray-200 rounded-xl"})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex h-screen",children:[e.jsxs("div",{className:"w-80 bg-white border-r flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Messages"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${v?"bg-green-400":"bg-red-400"}`}),e.jsx("span",{className:"text-xs text-gray-600",children:v?"Connected":"Disconnected"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:P.map(s=>{var i,r,l,c;return e.jsx("div",{onClick:()=>{j(s),b(s.id)},className:`p-4 border-b cursor-pointer hover:bg-gray-50 ${(t==null?void 0:t.id)===s.id?"bg-blue-50 border-r-4 border-r-blue-500":""}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(M,{className:"w-10 h-10",children:[e.jsx(R,{src:(i=s.participants[0])==null?void 0:i.avatar}),e.jsx(A,{children:(r=s.participants[0])==null?void 0:r.name.split(" ").map(o=>o[0]).join("").toUpperCase()})]}),((l=s.participants[0])==null?void 0:l.isOnline)&&e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-400 rounded-full border-2 border-white"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:((c=s.participants.filter(o=>o.id!==(a==null?void 0:a.id))[0])==null?void 0:c.name)||"Unknown"}),e.jsx(K,{variant:"secondary",className:"text-xs",children:s.type})]}),s.orderId&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Order #",s.orderId.slice(-6)]}),s.messages.length>0&&e.jsx("p",{className:"text-xs text-gray-600 truncate mt-1",children:s.messages[s.messages.length-1].message})]})]})},s.id)})})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 bg-white border-b flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(M,{className:"w-10 h-10",children:[e.jsx(R,{src:(I=t.participants[0])==null?void 0:I.avatar}),e.jsx(A,{children:(C=t.participants.filter(s=>s.id!==(a==null?void 0:a.id))[0])==null?void 0:C.name.split(" ").map(s=>s[0]).join("").toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:(E=t.participants.filter(s=>s.id!==(a==null?void 0:a.id))[0])==null?void 0:E.name}),e.jsx("p",{className:"text-xs text-gray-600",children:(S=t.participants.filter(s=>s.id!==(a==null?void 0:a.id))[0])!=null&&S.isOnline?"Online":"Last seen "+k(((T=t.participants.filter(s=>s.id!==(a==null?void 0:a.id))[0])==null?void 0:T.lastSeen)||Date.now())})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(h,{variant:"outline",size:"sm",children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(h,{variant:"outline",size:"sm",children:e.jsx(Z,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[t.messages.map((s,i)=>e.jsx("div",{className:`flex ${s.senderId===(a==null?void 0:a.id)?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-2xl ${s.senderId===(a==null?void 0:a.id)?"bg-blue-500 text-white":"bg-gray-100 text-gray-900"}`,children:[s.type==="location"?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"h-5 w-5"}),e.jsx("p",{className:"text-sm",children:"Location shared"})]}):e.jsx("p",{className:"text-sm",children:s.message}),e.jsxs("div",{className:`flex items-center justify-end space-x-1 mt-1 ${s.senderId===(a==null?void 0:a.id)?"text-blue-100":"text-gray-500"}`,children:[e.jsx("span",{className:"text-xs",children:k(s.timestamp)}),s.senderId===(a==null?void 0:a.id)&&q(s.status)]})]})},s.id)),V.length>0&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-100 px-4 py-2 rounded-2xl",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})}),e.jsx("div",{ref:N})]}),e.jsx("div",{className:"p-4 bg-white border-t",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(H,{ref:z,value:x,onChange:s=>{u(s.target.value),_()},onKeyPress:s=>{s.key==="Enter"&&w()},placeholder:"Type a message...",className:"rounded-full pr-12"}),e.jsx(h,{onClick:w,disabled:!x.trim(),size:"sm",className:"absolute right-1 top-1 rounded-full",children:e.jsx(D,{className:"h-4 w-4"})})]})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(D,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No conversation selected"}),e.jsx("p",{className:"text-gray-600",children:"Choose a conversation from the sidebar to start messaging"})]})})})]})})}export{ne as default};
//# sourceMappingURL=live-chat-enhanced-DE-FPq0G.js.map

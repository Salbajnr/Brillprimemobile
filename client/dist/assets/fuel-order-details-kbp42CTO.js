import{u as M,a as U,H as B,aP as Q,r,j as e,B as o,A as R,m,n as x,k as G,V as W,g as q,$ as H,af as C,I as _}from"./index-CPIh2kaR.js";import{L as J}from"./live-map-DXBjH6ZS.js";import{P as V}from"./phone-2OSRHZsq.js";import{M as Y}from"./minus-DLhJ3Pl9.js";import{P as K}from"./plus-DcVrLfik.js";function re(){const[,h]=M(),{user:O}=U(),{connected:L}=B(),{connected:k,orderUpdates:X,joinOrderRoom:F}=Q(),[t,P]=r.useState(null),[c,T]=r.useState("PMS"),[i,D]=r.useState(20),[u,g]=r.useState(""),[n,N]=r.useState(null),[y,A]=r.useState(""),[b,$]=r.useState(""),[v,w]=r.useState(!1),[E,z]=r.useState(!0),f=window.location.pathname.split("/").pop();r.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(s=>{const{latitude:a,longitude:l}=s.coords;N({lat:a,lng:l}),fetch(`https://api.openstreetmap.org/reverse?format=json&lat=${a}&lon=${l}`).then(j=>j.json()).then(j=>{j.display_name&&g(j.display_name)}).catch(console.error)},s=>{console.error("Error getting location:",s),N({lat:9.0765,lng:7.3986})},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},[]),r.useEffect(()=>{(async()=>{if(f)try{const a=await fetch(`/api/fuel/stations/${f}`,{credentials:"include"});if(a.ok){const l=await a.json();P(l.station)}else console.error("Failed to fetch station data")}catch(a){console.error("Error fetching station:",a)}finally{z(!1)}})()},[f]);const p=()=>{if(!t)return 0;const s=t.prices[c];return i*s+500},d=s=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN",minimumFractionDigits:0}).format(s),S=s=>{const a=i+s;a>=5&&a<=200&&D(a)},I=async()=>{if(!(!t||!O||!u.trim()||!n)){w(!0);try{const s={stationId:t.id,fuelType:c,quantity:i,unitPrice:t.prices[c],totalAmount:p(),deliveryAddress:u,deliveryLatitude:n.lat,deliveryLongitude:n.lng,scheduledDeliveryTime:y||void 0,notes:b||void 0},l=await(await fetch("/api/fuel/orders",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)})).json();l.success?(L&&console.log("Order created, WebSocket connected for real-time updates"),k&&F(l.order.id),h(`/order-confirmation/${l.order.id}`)):alert("Failed to place order: "+l.message)}catch(s){console.error("Order placement error:",s),alert("Failed to place order. Please try again.")}finally{w(!1)}}};return E?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading station details..."})]})}):t?e.jsxs("div",{className:"min-h-screen bg-gray-50 w-full max-w-md mx-auto",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>h("/fuel-ordering"),children:e.jsx(R,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-lg font-semibold text-[#131313]",children:"Order Fuel"}),e.jsx("div",{className:"w-10"})]})}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx(m,{children:e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-[#131313]",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:t.address}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(G,{className:"w-3 h-3"}),e.jsxs("span",{children:[t.distance.toFixed(1)," km away"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(W,{className:"w-3 h-3"}),e.jsx("span",{children:t.deliveryTime})]})]})]}),e.jsx(q,{className:t.isOpen?"bg-green-100 text-green-800":"bg-red-100 text-red-800",children:t.isOpen?"Open":"Closed"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>window.location.href=`tel:${t.phone}`,children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"Call"]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>h(`/chat/station/${t.id}`),children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),"Chat"]})]})]})}),n&&e.jsx(m,{children:e.jsxs(x,{className:"p-4",children:[e.jsx("h4",{className:"font-medium text-[#131313] mb-3",children:"Station Location"}),e.jsx("div",{className:"h-48 rounded-lg overflow-hidden",children:e.jsx(J,{showUserLocation:!0,showNearbyUsers:!1,className:"w-full h-full",userRole:"CONSUMER",center:{lat:t.latitude,lng:t.longitude},markers:[{lat:t.latitude,lng:t.longitude,title:t.name,type:"station"},{lat:n.lat,lng:n.lng,title:"Your Location",type:"user"}]})})]})}),e.jsx(m,{children:e.jsxs(x,{className:"p-4",children:[e.jsx("h4",{className:"font-medium text-[#131313] mb-3",children:"Select Fuel Type"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:t.fuelTypes.map(s=>e.jsxs("button",{onClick:()=>T(s),className:`p-3 rounded-lg border text-center transition-colors ${c===s?"border-[#4682b4] bg-[#4682b4]/10 text-[#4682b4]":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"font-medium",children:s}),e.jsxs("div",{className:"text-sm text-gray-600",children:[d(t.prices[s]),"/L"]})]},s))})]})}),e.jsx(m,{children:e.jsxs(x,{className:"p-4",children:[e.jsx("h4",{className:"font-medium text-[#131313] mb-3",children:"Quantity (Liters)"}),e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsx(o,{variant:"outline",size:"icon",onClick:()=>S(-5),disabled:i<=5,children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-[#4682b4]",children:[i,"L"]}),e.jsx("div",{className:"text-sm text-gray-600",children:d(i*t.prices[c])})]}),e.jsx(o,{variant:"outline",size:"icon",onClick:()=>S(5),disabled:i>=200,children:e.jsx(K,{className:"w-4 h-4"})})]})]})}),e.jsx(m,{children:e.jsxs(x,{className:"p-4 space-y-4",children:[e.jsx("h4",{className:"font-medium text-[#131313]",children:"Delivery Details"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Address *"}),e.jsx(C,{placeholder:"Enter your delivery address",value:u,onChange:s=>g(s.target.value),className:"resize-none",rows:3}),n&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["GPS coordinates: ",n.lat.toFixed(6),", ",n.lng.toFixed(6)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Preferred Delivery Time (Optional)"}),e.jsx(_,{type:"datetime-local",value:y,onChange:s=>A(s.target.value),min:new Date().toISOString().slice(0,16)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Special Notes (Optional)"}),e.jsx(C,{placeholder:"Any special instructions for delivery",value:b,onChange:s=>$(s.target.value),className:"resize-none",rows:2})]})]})}),e.jsx(m,{children:e.jsxs(x,{className:"p-4",children:[e.jsx("h4",{className:"font-medium text-[#131313] mb-3",children:"Order Summary"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Fuel (",i,"L ",c,")"]}),e.jsx("span",{children:d(i*t.prices[c])})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Delivery Fee"}),e.jsx("span",{children:d(500)})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-[#4682b4]",children:d(p())})]})]})]})}),e.jsx(o,{onClick:I,disabled:!u.trim()||v||!n,className:"w-full h-12 bg-[#4682b4] hover:bg-[#0b1a51] text-white rounded-xl",children:v?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Placing Order..."})]}):`Place Order - ${d(p())}`})]})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Station not found"}),e.jsx(o,{onClick:()=>h("/fuel-ordering"),children:"Back to Fuel Ordering"})]})})}export{re as default};
//# sourceMappingURL=fuel-order-details-kbp42CTO.js.map

import{c as F,u as H,r as n,ah as x,j as e,B as l,A as D,m as b,n as f,g as y,K as T,aV as W,X as K}from"./index-CVqmz7v7.js";import{s as I,e as E}from"./confirmation_fail_img-l7dZ-eC2.js";import{C as S}from"./check-Bv_Y_Lo5.js";import{C as u}from"./camera-CLhouQFu.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=F("FlashlightOff",[["path",{d:"M16 16v4a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2V10c0-2-2-2-2-4",key:"1r120k"}],["path",{d:"M7 2h11v4c0 2-2 2-2 4v1",key:"dz1920"}],["line",{x1:"11",x2:"18",y1:"6",y2:"6",key:"bi1vpe"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=F("Flashlight",[["path",{d:"M18 6c0 2-2 2-2 4v10a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2V10c0-2-2-2-2-4V2h12z",key:"1orkel"}],["line",{x1:"6",x2:"18",y1:"6",y2:"6",key:"1z11jq"}],["line",{x1:"12",x2:"12",y1:"12",y2:"12",key:"1f4yc1"}]]),G={PRIMARY:"#4682b4"};function ne(){const[,j]=H(),[m,h]=n.useState(!1),[v,R]=n.useState(null),[N,A]=n.useState(!1),[Q,B]=n.useState("environment"),[a,p]=n.useState(null),[c,o]=n.useState({isOpen:!1,type:"success",title:"",message:""}),[Z,ee]=n.useState(!1),r=n.useRef(null),w=n.useRef(null),i=n.useRef(null);n.useEffect(()=>((async()=>{try{const t=await navigator.mediaDevices.getUserMedia({video:!0});R(!0),t.getTracks().forEach(d=>d.stop())}catch(t){console.error("Camera permission error:",t),R(!1),o({isOpen:!0,type:"error",title:"Camera Permission Denied",message:"Please grant camera access in your browser settings to use the QR scanner."})}})(),()=>{i.current&&i.current.getTracks().forEach(t=>t.stop())}),[]);const L=n.useCallback(async()=>{if(v===!1){x({title:"Camera Access Required",description:"Please grant camera permissions to scan.",variant:"destructive"});return}try{const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:640},height:{ideal:480}}});if(i.current=s,r.current){r.current.srcObject=s,await r.current.play(),h(!0);const t=setInterval(()=>{if(r.current&&w.current){const d=w.current,g=r.current,O=d.getContext("2d");O&&(d.width=g.videoWidth,d.height=g.videoHeight,O.drawImage(g,0,0,d.width,d.height),g.videoWidth>0&&setTimeout(()=>{const _=M();p(_),C(),clearInterval(t)},3e3))}},100);return()=>{clearInterval(t)}}}catch(s){console.error("Camera access error:",s),x({title:"Camera Error",description:"Unable to access camera. Please check permissions.",variant:"destructive"}),C()}},[v,x]),C=n.useCallback(()=>{r.current&&r.current.srcObject&&(r.current.srcObject.getTracks().forEach(t=>t.stop()),r.current.srcObject=null),h(!1),i.current&&(i.current.getTracks().forEach(s=>s.stop()),i.current=null)},[]),M=()=>{const s=["delivery","payment","merchant"];switch(s[Math.floor(Math.random()*s.length)]){case"delivery":return{type:"delivery",data:{orderId:"ORDER_"+Math.random().toString(36).substr(2,9),driverName:"Driver "+Math.random().toString(36).substr(2,5),deliveryTime:new Date().toLocaleTimeString(),items:["Item A","Item B"],totalAmount:`$${(Math.random()*100).toFixed(2)}`}};case"payment":return{type:"payment",data:{merchantName:"BrillPrime Merchant "+Math.floor(Math.random()*100),merchantId:"MERCHANT_"+Math.random().toString(36).substr(2,9),reference:"PAY_"+Date.now(),amount:`$${(Math.random()*5e3).toFixed(2)}`}};case"merchant":return{type:"merchant",data:{businessName:"BrillPrime Service",address:"123 Main St, Lagos",phone:"+234 "+Math.floor(Math.random()*9e8+1e8),services:["Delivery","Payment","Support"]}};default:return{type:"UNKNOWN",data:"Sample QR data"}}},k=s=>{h(!0),setTimeout(()=>{const t=M();p(t),h(!1)},2e3)},P=()=>{i.current&&(i.current.getTracks().forEach(s=>s.stop()),i.current=null),h(!1)},V=async()=>{if(i.current){const s=i.current.getVideoTracks()[0];if(s.getCapabilities&&s.getCapabilities().torch)try{await s.applyConstraints({advanced:[{torch:!N}]}),A(!N)}catch(t){console.error("Flashlight toggle error:",t),x({title:"Flashlight Error",description:"Could not toggle flashlight.",variant:"destructive"})}else x({title:"Flashlight Not Supported",description:"Your device does not support flashlight control.",variant:"info"})}},z=()=>{P();const s=Q==="user"?"environment":"user";B(s),setTimeout(async()=>{try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:s,width:{ideal:1280},height:{ideal:720}}});i.current=t,r.current&&(r.current.srcObject=t,r.current.play(),h(!0))}catch(t){console.error("Error switching camera:",t),x({title:"Camera Switch Error",description:"Could not switch camera. Please try again.",variant:"destructive"}),P()}},100)},U=async()=>{if(!(!a||a.type!=="delivery")){try{const t=await(await fetch("/api/qr/verify-delivery",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({orderId:a.data.orderId,qrCode:`DELIVERY_${a.data.orderId}_${Date.now()}`,driverConfirmed:!0})})).json();t.success?(o({isOpen:!0,type:"success",title:"Delivery Confirmed âœ…",message:"Your delivery has been verified and confirmed successfully. Payment has been processed. Thank you for using Brillprime!"}),setTimeout(()=>{j("/order-history")},3e3)):o({isOpen:!0,type:"error",title:"Verification Failed",message:t.message||"Unable to verify delivery. Please try again or contact support."})}catch(s){console.error("Delivery verification error:",s),o({isOpen:!0,type:"error",title:"Connection Error",message:"Unable to connect to verification service. Please check your internet connection."})}p(null)}},q=()=>{o({isOpen:!0,type:"success",title:"Payment Processing",message:"Redirecting to payment confirmation. Please wait..."}),setTimeout(()=>{j("/payment-methods")},2e3)},Y=()=>{o({isOpen:!0,type:"success",title:"Contact Saved",message:"Merchant contact information has been saved to your favorites."}),p(null)},$=()=>{m?C():L()};return a?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-blue-100/50 animate-fade-in",children:e.jsx("div",{className:"flex items-center justify-between p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>p(null),className:"transition-all duration-300 hover:scale-110",children:e.jsx(D,{className:"w-5 h-5 text-[#131313]"})}),e.jsxs("div",{className:"animate-slide-up",children:[e.jsx("h1",{className:"text-lg font-semibold text-[#131313]",children:"Scan Result"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Review and confirm details"})]})]})})}),e.jsxs("div",{className:"p-4 space-y-4",children:[a.type==="delivery"&&e.jsx(b,{className:"rounded-3xl border-2 border-blue-100/50 bg-white animate-fade-in-up",children:e.jsxs(f,{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(S,{className:"w-8 h-8 text-green-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-[#131313] mb-2",children:"Delivery Verification"}),e.jsxs(y,{className:"bg-green-100 text-green-800",children:["Order #",a.data.orderId]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600",children:"Driver"}),e.jsx("span",{className:"font-medium text-[#131313]",children:a.data.driverName})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600",children:"Delivery Time"}),e.jsx("span",{className:"font-medium text-[#131313]",children:a.data.deliveryTime})]}),e.jsxs("div",{className:"py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600 block mb-2",children:"Items Delivered"}),a.data.items.map((s,t)=>e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(S,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"font-medium text-[#131313]",children:s})]},t))]}),e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-gray-600",children:"Total Amount"}),e.jsx("span",{className:"font-bold text-[#4682b4] text-lg",children:a.data.totalAmount})]})]}),e.jsx(l,{onClick:U,className:"w-full mt-6 bg-[#4682b4] hover:bg-[#0b1a51] text-white rounded-2xl transition-colors duration-300",children:"Confirm Delivery"})]})}),a.type==="payment"&&e.jsx(b,{className:"rounded-3xl border-2 border-blue-100/50 bg-white animate-fade-in-up",children:e.jsxs(f,{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(u,{className:"w-8 h-8 text-blue-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-[#131313] mb-2",children:"Payment Request"}),e.jsx(y,{className:"bg-blue-100 text-blue-800",children:"Merchant Payment"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600",children:"Merchant"}),e.jsx("span",{className:"font-medium text-[#131313]",children:a.data.merchantName})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600",children:"Merchant ID"}),e.jsx("span",{className:"font-medium text-[#131313]",children:a.data.merchantId})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600",children:"Reference"}),e.jsx("span",{className:"font-medium text-[#131313]",children:a.data.reference})]}),e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-gray-600",children:"Amount"}),e.jsx("span",{className:"font-bold text-[#4682b4] text-xl",children:a.data.amount})]})]}),e.jsx(l,{onClick:q,className:"w-full mt-6 bg-[#4682b4] hover:bg-[#0b1a51] text-white rounded-2xl transition-colors duration-300",children:"Proceed to Payment"})]})}),a.type==="merchant"&&e.jsx(b,{className:"rounded-3xl border-2 border-blue-100/50 bg-white animate-fade-in-up",children:e.jsxs(f,{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(u,{className:"w-8 h-8 text-purple-600"})}),e.jsx("h2",{className:"text-xl font-semibold text-[#131313] mb-2",children:"Merchant Information"}),e.jsx(y,{className:"bg-purple-100 text-purple-800",children:"Business Contact"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600",children:"Business Name"}),e.jsx("span",{className:"font-medium text-[#131313]",children:a.data.businessName})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600",children:"Address"}),e.jsx("span",{className:"font-medium text-[#131313] text-right",children:a.data.address})]}),e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-gray-600",children:"Phone"}),e.jsx("span",{className:"font-medium text-[#131313]",children:a.data.phone})]}),e.jsxs("div",{className:"py-2",children:[e.jsx("span",{className:"text-gray-600 block mb-2",children:"Services"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.data.services.map((s,t)=>e.jsx(y,{variant:"secondary",className:"rounded-2xl",children:s},t))})]})]}),e.jsx(l,{onClick:Y,className:"w-full mt-6 bg-[#4682b4] hover:bg-[#0b1a51] text-white rounded-2xl transition-colors duration-300",children:"Save Contact"})]})})]}),e.jsx(T,{isOpen:c.isOpen,onClose:()=>o(s=>({...s,isOpen:!1})),type:c.type,title:c.title,message:c.message,imageSrc:c.type==="success"?I:E})]}):e.jsxs("div",{className:"min-h-screen bg-gray-50 w-full max-w-sm sm:max-w-md md:max-w-lg lg:max-w-xl xl:max-w-2xl mx-auto px-2 sm:px-4",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-blue-100/50 animate-fade-in",children:e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>j("/consumer-home"),className:"transition-all duration-300 hover:scale-110",children:e.jsx(D,{className:"w-5 h-5 text-[#131313]"})}),e.jsxs("div",{className:"animate-slide-up",children:[e.jsx("h1",{className:"text-lg font-semibold text-[#131313]",children:"QR Scanner"}),e.jsx("p",{className:"text-sm text-gray-600",children:m?"Point camera at QR code":"Scan QR codes for payments & deliveries"})]})]}),m&&e.jsxs("div",{className:"flex items-center space-x-2 animate-slide-in-right",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:V,className:"transition-all duration-300 hover:scale-110",children:N?e.jsx(J,{className:"w-5 h-5"}):e.jsx(X,{className:"w-5 h-5"})}),e.jsx(l,{variant:"ghost",size:"icon",onClick:z,className:"transition-all duration-300 hover:scale-110",children:e.jsx(W,{className:"w-5 h-5"})})]})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(b,{className:"rounded-3xl border-2 border-blue-100/50 bg-white overflow-hidden animate-fade-in-up",children:e.jsx(f,{className:"p-0",children:e.jsx("div",{className:"relative w-full bg-black aspect-video",children:m?e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:r,className:"w-full h-full object-cover",playsInline:!0,muted:!0,autoPlay:!0}),e.jsx("canvas",{ref:w,className:"absolute inset-0 w-full h-full pointer-events-none"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-0 left-0 w-8 h-8 border-l-4 border-t-4 border-[#4682b4] rounded-tl-lg"}),e.jsx("div",{className:"absolute top-0 right-0 w-8 h-8 border-r-4 border-t-4 border-[#4682b4] rounded-tr-lg"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-8 h-8 border-l-4 border-b-4 border-[#4682b4] rounded-bl-lg"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-8 h-8 border-r-4 border-b-4 border-[#4682b4] rounded-br-lg"}),e.jsx("div",{className:"absolute inset-0 w-64 h-64 overflow-hidden rounded-3xl",children:e.jsx("div",{className:"w-full h-0.5 bg-[#4682b4] animate-pulse absolute top-1/2 transform -translate-y-1/2"})})]})}),e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2",children:e.jsx("p",{className:"text-white text-sm bg-black/50 px-3 py-1 rounded-2xl",children:"Align QR code within the frame"})})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx(u,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Camera Ready"}),e.jsx("p",{className:"text-sm opacity-75",children:"Tap start to begin scanning"})]})})})})}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsx(l,{onClick:$,disabled:v===!1&&!m,className:"w-full py-4 rounded-3xl text-lg font-semibold transition-all duration-300 hover:scale-105",style:{backgroundColor:G.PRIMARY},children:m?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-5 h-5 mr-2"}),"Stop Scanning"]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"w-5 h-5 mr-2"}),"Start QR Scanner"]})})}),e.jsx(b,{className:"rounded-3xl border-2 border-blue-100/50 bg-white animate-fade-in-up",children:e.jsxs(f,{className:"p-4",children:[e.jsx("h3",{className:"font-medium text-[#131313] mb-3",children:"Test QR Code Types"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsxs(l,{variant:"outline",onClick:()=>k(),className:"justify-start border-2 border-green-200 text-green-700 hover:bg-green-50 rounded-2xl transition-all duration-300 hover:scale-105",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Delivery Confirmation"]}),e.jsxs(l,{variant:"outline",onClick:()=>k(),className:"justify-start border-2 border-blue-200 text-blue-700 hover:bg-blue-50 rounded-2xl transition-all duration-300 hover:scale-105",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"Payment QR Code"]}),e.jsxs(l,{variant:"outline",onClick:()=>k(),className:"justify-start border-2 border-purple-200 text-purple-700 hover:bg-purple-50 rounded-2xl transition-all duration-300 hover:scale-105",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"Merchant Contact"]})]})]})})]}),e.jsx(T,{isOpen:c.isOpen,onClose:()=>o(s=>({...s,isOpen:!1})),type:c.type,title:c.title,message:c.message,imageSrc:c.type==="success"?I:E})]})}export{ne as default};
//# sourceMappingURL=qr-scanner-DRnGlf9v.js.map

{"version":3,"file":"social-auth-B25nWjSb.js","sources":["../../src/lib/social-auth.ts"],"sourcesContent":["// Social authentication library for Google, Apple, and Facebook\ndeclare global {\n  interface Window {\n    google?: any;\n    FB?: any;\n    AppleID?: any;\n  }\n}\n\ninterface SocialProfile {\n  id: string\n  email: string\n  name: string\n  provider: 'google' | 'apple' | 'facebook'\n  avatar?: string\n}\n\ninterface SocialAuthCallbacks {\n  onSuccess: (profile: SocialProfile) => Promise<void>\n  onError: (error: Error) => void\n}\n\nclass SocialAuth {\n  private callbacks?: SocialAuthCallbacks\n  private googleInitialized = false\n  private facebookInitialized = false\n  private appleInitialized = false\n\n  setCallbacks(onSuccess: (profile: SocialProfile) => Promise<void>, onError: (error: Error) => void) {\n    this.callbacks = { onSuccess, onError }\n  }\n\n  async signInWithGoogle(): Promise<void> {\n    try {\n      if (!this.googleInitialized) {\n        throw new Error('Google Sign-In not initialized')\n      }\n\n      if (!window.google?.accounts) {\n        // Fallback to API call for server-side verification\n        const response = await fetch('/api/auth/social-login', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ provider: 'google' })\n        });\n\n        if (!response.ok) {\n          throw new Error('Google authentication failed')\n        }\n\n        const data = await response.json();\n        if (data.success && this.callbacks?.onSuccess) {\n          await this.callbacks.onSuccess(data.profile)\n        }\n        return;\n      }\n\n      window.google.accounts.oauth2.initTokenClient({\n        client_id: import.meta.env.VITE_GOOGLE_CLIENT_ID,\n        scope: 'email profile',\n        callback: async (response: any) => {\n          try {\n            const userInfo = await fetch(`https://www.googleapis.com/oauth2/v2/userinfo?access_token=${response.access_token}`);\n            const profile = await userInfo.json();\n            \n            const socialProfile: SocialProfile = {\n              id: profile.id,\n              email: profile.email,\n              name: profile.name,\n              provider: 'google',\n              avatar: profile.picture\n            }\n            \n            if (this.callbacks?.onSuccess) {\n              await this.callbacks.onSuccess(socialProfile)\n            }\n          } catch (error) {\n            if (this.callbacks?.onError) {\n              this.callbacks.onError(error as Error)\n            }\n          }\n        }\n      }).requestAccessToken();\n\n    } catch (error) {\n      if (this.callbacks?.onError) {\n        this.callbacks.onError(error as Error)\n      }\n    }\n  }\n\n  async signInWithApple(): Promise<void> {\n    try {\n      if (!this.appleInitialized) {\n        throw new Error('Apple Sign-In not initialized')\n      }\n\n      if (!window.AppleID) {\n        // Fallback to API call\n        const response = await fetch('/api/auth/social-login', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ provider: 'apple' })\n        });\n\n        if (!response.ok) {\n          throw new Error('Apple authentication failed')\n        }\n\n        const data = await response.json();\n        if (data.success && this.callbacks?.onSuccess) {\n          await this.callbacks.onSuccess(data.profile)\n        }\n        return;\n      }\n\n      window.AppleID.auth.signIn().then((response: any) => {\n        const { authorization } = response;\n        const socialProfile: SocialProfile = {\n          id: authorization.user,\n          email: authorization.email || '',\n          name: `${authorization.name?.firstName || ''} ${authorization.name?.lastName || ''}`.trim(),\n          provider: 'apple'\n        }\n        \n        if (this.callbacks?.onSuccess) {\n          this.callbacks.onSuccess(socialProfile)\n        }\n      });\n\n    } catch (error) {\n      if (this.callbacks?.onError) {\n        this.callbacks.onError(error as Error)\n      }\n    }\n  }\n\n  async signInWithFacebook(): Promise<void> {\n    try {\n      if (!this.facebookInitialized) {\n        throw new Error('Facebook SDK not initialized')\n      }\n\n      if (!window.FB) {\n        // Fallback to API call\n        const response = await fetch('/api/auth/social-login', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ provider: 'facebook' })\n        });\n\n        if (!response.ok) {\n          throw new Error('Facebook authentication failed')\n        }\n\n        const data = await response.json();\n        if (data.success && this.callbacks?.onSuccess) {\n          await this.callbacks.onSuccess(data.profile)\n        }\n        return;\n      }\n\n      window.FB.login((response: any) => {\n        if (response.authResponse) {\n          window.FB.api('/me', { fields: 'name,email,picture' }, (userInfo: any) => {\n            const socialProfile: SocialProfile = {\n              id: userInfo.id,\n              email: userInfo.email,\n              name: userInfo.name,\n              provider: 'facebook',\n              avatar: userInfo.picture?.data?.url\n            }\n            \n            if (this.callbacks?.onSuccess) {\n              this.callbacks.onSuccess(socialProfile)\n            }\n          });\n        } else {\n          if (this.callbacks?.onError) {\n            this.callbacks.onError(new Error('Facebook login cancelled'))\n          }\n        }\n      }, { scope: 'email' });\n\n    } catch (error) {\n      if (this.callbacks?.onError) {\n        this.callbacks.onError(error as Error)\n      }\n    }\n  }\n\n  // Initialize social auth providers\n  async initialize(): Promise<void> {\n    try {\n      // Initialize Google\n      await this.initializeGoogle();\n      \n      // Initialize Facebook\n      await this.initializeFacebook();\n      \n      // Initialize Apple\n      await this.initializeApple();\n\n      console.log('Social auth providers initialized')\n    } catch (error) {\n      console.error('Failed to initialize social auth:', error)\n    }\n  }\n\n  private async initializeGoogle(): Promise<void> {\n    try {\n      if (typeof window !== 'undefined' && import.meta.env.VITE_GOOGLE_CLIENT_ID) {\n        const script = document.createElement('script');\n        script.src = 'https://accounts.google.com/gsi/client';\n        script.async = true;\n        document.head.appendChild(script);\n        \n        await new Promise((resolve) => {\n          script.onload = resolve;\n        });\n\n        this.googleInitialized = true;\n      }\n    } catch (error) {\n      console.warn('Google Sign-In initialization failed:', error);\n    }\n  }\n\n  private async initializeFacebook(): Promise<void> {\n    try {\n      if (typeof window !== 'undefined' && import.meta.env.VITE_FACEBOOK_APP_ID) {\n        const script = document.createElement('script');\n        script.src = 'https://connect.facebook.net/en_US/sdk.js';\n        script.async = true;\n        document.head.appendChild(script);\n        \n        await new Promise((resolve) => {\n          script.onload = () => {\n            window.FB.init({\n              appId: import.meta.env.VITE_FACEBOOK_APP_ID,\n              cookie: true,\n              xfbml: true,\n              version: 'v18.0'\n            });\n            resolve(null);\n          };\n        });\n\n        this.facebookInitialized = true;\n      }\n    } catch (error) {\n      console.warn('Facebook SDK initialization failed:', error);\n    }\n  }\n\n  private async initializeApple(): Promise<void> {\n    try {\n      if (typeof window !== 'undefined' && import.meta.env.VITE_APPLE_CLIENT_ID) {\n        const script = document.createElement('script');\n        script.src = 'https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js';\n        script.async = true;\n        document.head.appendChild(script);\n        \n        await new Promise((resolve) => {\n          script.onload = () => {\n            window.AppleID.auth.init({\n              clientId: import.meta.env.VITE_APPLE_CLIENT_ID,\n              scope: 'name email',\n              redirectURI: `${window.location.origin}/auth/apple/callback`,\n              usePopup: true\n            });\n            resolve(null);\n          };\n        });\n\n        this.appleInitialized = true;\n      }\n    } catch (error) {\n      console.warn('Apple Sign-In initialization failed:', error);\n    }\n  }\n\n  // Check if providers are available\n  isGoogleAvailable(): boolean {\n    return this.googleInitialized && !!import.meta.env.VITE_GOOGLE_CLIENT_ID\n  }\n\n  isAppleAvailable(): boolean {\n    return this.appleInitialized && !!import.meta.env.VITE_APPLE_CLIENT_ID\n  }\n\n  isFacebookAvailable(): boolean {\n    return this.facebookInitialized && !!import.meta.env.VITE_FACEBOOK_APP_ID\n  }\n}\n\nexport const socialAuth = new SocialAuth()\n\n// Initialize on module load\nsocialAuth.initialize().catch(console.error)"],"names":["SocialAuth","__publicField","onSuccess","onError","_a","_b","_c","response","data","profile","socialProfile","error","authorization","userInfo","socialAuth"],"mappings":"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"}
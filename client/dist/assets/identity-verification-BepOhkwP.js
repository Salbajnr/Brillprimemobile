import{c as Q,u as K,a as Z,r as o,f as _,j as e,aM as ee,C as P,B as t,A as se,m as p,s as N,t as v,F as re,n as g,I as y,aQ as le,a3 as ie,h as ae,g as w}from"./index-CVqmz7v7.js";import{L as h}from"./label-FpSljPAT.js";import{S as ce,a as te,b as oe,c as ne,d as de}from"./select-B0T04BLa.js";import{a as me}from"./queryClient-A1RmhH99.js";import{U as L}from"./upload-DWZGy76o.js";import{C as he}from"./car-C8Z-P9-t.js";import{C as E}from"./camera-CLhouQFu.js";import{P as xe}from"./phone-0BJ47FE1.js";import"./check-Bv_Y_Lo5.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=Q("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),i={PRIMARY:"#4682b4",SECONDARY:"#0b1a51",ACTIVE:"#010e42",TEXT:"#131313",WHITE:"#ffffff"};function Re(){const[,b]=K(),{user:r}=Z(),[a,C]=o.useState(0),[c,d]=o.useState((r==null?void 0:r.role)==="DRIVER"?{licenseNumber:"",licenseExpiry:"",vehicleType:"",vehiclePlate:"",vehicleModel:"",vehicleYear:"",faceVerification:!1}:{phoneVerification:!1,emailVerification:(r==null?void 0:r.isVerified)||!1,faceVerification:!1}),[x,R]=o.useState(null),[u,M]=o.useState(null),m=o.useRef(null),V=o.useRef(null),[U,A]=o.useState(!1),[S,Y]=o.useState(0),H=[{id:"license",title:"Driver License Verification",description:"Upload your valid driver license",completed:!1,required:!0},{id:"vehicle",title:"Vehicle Registration",description:"Register your vehicle details",completed:!1,required:!0},{id:"face",title:"Face Verification",description:"Verify your identity with face recognition",completed:!1,required:!0}],B=[{id:"email",title:"Email Verification",description:"Verify your email address",completed:(r==null?void 0:r.isVerified)||!1,required:!0},{id:"phone",title:"Phone Verification",description:"Verify your phone number",completed:!1,required:!0},{id:"face",title:"Face Verification",description:"Verify your identity with face recognition",completed:!1,required:!0}],f=(r==null?void 0:r.role)==="DRIVER"?H:B,q=["Motorcycle","Car","Van","Truck","Bicycle"],W=async()=>{try{const s=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480,facingMode:"user"}});m.current&&(m.current.srcObject=s,A(!0))}catch(s){console.error("Error accessing camera:",s)}},k=()=>{var s;(s=m.current)!=null&&s.srcObject&&(m.current.srcObject.getTracks().forEach(n=>n.stop()),A(!1))},G=()=>{if(m.current&&V.current){const s=V.current,l=m.current,n=s.getContext("2d");s.width=l.videoWidth,s.height=l.videoHeight,n&&(n.drawImage(l,0,0),s.toBlob(j=>{if(j){const $=new File([j],"face-verification.jpg",{type:"image/jpeg"});R($),k()}},"image/jpeg",.8))}},T=(s,l)=>{var j;const n=(j=s.target.files)==null?void 0:j[0];n&&(l==="license"?M(n):R(n))},I=_({mutationFn:s=>me("POST","/api/auth/verify-identity"),onSuccess:()=>{b((r==null?void 0:r.role)==="DRIVER"?"/driver-dashboard":"/consumer-home")}});o.useEffect(()=>{const s=f.filter(l=>l.completed).length;Y(s/f.length*100)},[f]);const X=()=>e.jsxs(p,{className:"rounded-3xl border-2 shadow-xl",style:{borderColor:i.PRIMARY},children:[e.jsx(N,{children:e.jsxs(v,{className:"flex items-center",style:{color:i.SECONDARY},children:[e.jsx(re,{className:"h-6 w-6 mr-3"}),"Driver License Verification"]})}),e.jsxs(g,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"licenseNumber",children:"License Number"}),e.jsx(y,{id:"licenseNumber",placeholder:"Enter license number",value:c.licenseNumber||"",onChange:s=>d(l=>({...l,licenseNumber:s.target.value})),className:"rounded-xl border-2",style:{borderColor:i.PRIMARY+"40"}})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"licenseExpiry",children:"Expiry Date"}),e.jsx(y,{id:"licenseExpiry",type:"date",value:c.licenseExpiry||"",onChange:s=>d(l=>({...l,licenseExpiry:s.target.value})),className:"rounded-xl border-2",style:{borderColor:i.PRIMARY+"40"}})]})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Upload License Image"}),e.jsx("div",{className:"mt-2",children:u?e.jsx("div",{className:"p-4 border-2 border-dashed rounded-xl",style:{borderColor:i.PRIMARY},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(P,{className:"h-6 w-6 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:u.name})]}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>M(null),children:e.jsx(le,{className:"h-4 w-4"})})]})}):e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-xl cursor-pointer hover:bg-gray-50",style:{borderColor:i.PRIMARY},children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx(L,{className:"h-8 w-8 mb-2",style:{color:i.PRIMARY}}),e.jsxs("p",{className:"text-sm",style:{color:i.TEXT},children:[e.jsx("span",{className:"font-semibold",children:"Click to upload"})," driver license"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG up to 5MB"})]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:s=>T(s,"license")})]})})]})]})]}),z=()=>e.jsxs(p,{className:"rounded-3xl border-2 shadow-xl",style:{borderColor:i.PRIMARY},children:[e.jsx(N,{children:e.jsxs(v,{className:"flex items-center",style:{color:i.SECONDARY},children:[e.jsx(he,{className:"h-6 w-6 mr-3"}),"Vehicle Registration"]})}),e.jsxs(g,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Vehicle Type"}),e.jsxs(ce,{value:c.vehicleType||"",onValueChange:s=>d(l=>({...l,vehicleType:s})),children:[e.jsx(te,{className:"rounded-xl border-2",style:{borderColor:i.PRIMARY+"40"},children:e.jsx(oe,{placeholder:"Select vehicle type"})}),e.jsx(ne,{children:q.map(s=>e.jsx(de,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"vehiclePlate",children:"Vehicle Plate Number"}),e.jsx(y,{id:"vehiclePlate",placeholder:"e.g., LAG-123-AA",value:c.vehiclePlate||"",onChange:s=>d(l=>({...l,vehiclePlate:s.target.value.toUpperCase()})),className:"rounded-xl border-2",style:{borderColor:i.PRIMARY+"40"}})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"vehicleModel",children:"Vehicle Model"}),e.jsx(y,{id:"vehicleModel",placeholder:"e.g., Honda CB 150",value:c.vehicleModel||"",onChange:s=>d(l=>({...l,vehicleModel:s.target.value})),className:"rounded-xl border-2",style:{borderColor:i.PRIMARY+"40"}})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"vehicleYear",children:"Vehicle Year"}),e.jsx(y,{id:"vehicleYear",type:"number",placeholder:"e.g., 2020",min:"2000",max:new Date().getFullYear()+1,value:c.vehicleYear||"",onChange:s=>d(l=>({...l,vehicleYear:s.target.value})),className:"rounded-xl border-2",style:{borderColor:i.PRIMARY+"40"}})]})]})]})]}),D=()=>e.jsxs(p,{className:"rounded-3xl border-2 shadow-xl",style:{borderColor:i.PRIMARY},children:[e.jsx(N,{children:e.jsxs(v,{className:"flex items-center",style:{color:i.SECONDARY},children:[e.jsx(ie,{className:"h-6 w-6 mr-3"}),"Face Verification"]})}),e.jsxs(g,{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Take a clear photo of your face for identity verification"}),x?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:URL.createObjectURL(x),alt:"Face verification",className:"w-48 h-48 object-cover rounded-xl border-2",style:{borderColor:i.PRIMARY}})}),e.jsxs("div",{className:"flex space-x-3 justify-center",children:[e.jsx(t,{variant:"outline",onClick:()=>R(null),className:"rounded-xl",children:"Retake Photo"}),e.jsx(t,{onClick:()=>d(s=>({...s,faceVerification:!0})),className:"rounded-xl",style:{backgroundColor:i.PRIMARY,color:i.WHITE},children:"Confirm Photo"})]})]}):e.jsx("div",{className:"space-y-4",children:U?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("video",{ref:m,autoPlay:!0,playsInline:!0,className:"w-64 h-48 object-cover rounded-xl border-2",style:{borderColor:i.PRIMARY}})}),e.jsxs("div",{className:"flex space-x-3 justify-center",children:[e.jsx(t,{variant:"outline",onClick:k,className:"rounded-xl",children:"Cancel"}),e.jsxs(t,{onClick:G,className:"rounded-xl",style:{backgroundColor:i.PRIMARY,color:i.WHITE},children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Capture"]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-64 h-48 mx-auto border-2 border-dashed rounded-xl flex items-center justify-center",style:{borderColor:i.PRIMARY},children:e.jsx(E,{className:"h-12 w-12",style:{color:i.PRIMARY}})}),e.jsxs("div",{className:"flex space-x-3 justify-center",children:[e.jsxs(t,{onClick:W,className:"rounded-xl",style:{backgroundColor:i.PRIMARY,color:i.WHITE},children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Start Camera"]}),e.jsxs("label",{children:[e.jsx(t,{variant:"outline",className:"rounded-xl",asChild:!0,children:e.jsxs("span",{children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Upload Photo"]})}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:s=>T(s,"face")})]})]})]})})]}),e.jsx("canvas",{ref:V,className:"hidden"})]})]}),F=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{className:"rounded-3xl border-2 shadow-xl",style:{borderColor:i.PRIMARY},children:[e.jsx(N,{children:e.jsxs(v,{className:"flex items-center justify-between",style:{color:i.SECONDARY},children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"h-6 w-6 mr-3"}),"Email Verification"]}),r!=null&&r.isVerified?e.jsxs(w,{className:"bg-green-100 text-green-800",children:[e.jsx(P,{className:"h-4 w-4 mr-1"}),"Verified"]}):e.jsx(w,{className:"bg-yellow-100 text-yellow-800",children:"Pending"})]})}),e.jsx(g,{children:r!=null&&r.isVerified?e.jsx("p",{className:"text-green-600",children:"Your email address has been verified successfully."}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Please check your email and click the verification link."}),e.jsx(t,{variant:"outline",className:"rounded-xl",onClick:()=>{},children:"Resend Verification Email"})]})})]}),e.jsxs(p,{className:"rounded-3xl border-2 shadow-xl",style:{borderColor:i.PRIMARY},children:[e.jsx(N,{children:e.jsxs(v,{className:"flex items-center",style:{color:i.SECONDARY},children:[e.jsx(xe,{className:"h-6 w-6 mr-3"}),"Phone Verification"]})}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-sm",children:["Phone: ",r==null?void 0:r.phone]}),e.jsx(w,{className:"bg-yellow-100 text-yellow-800",children:"Pending"})]}),e.jsx(t,{className:"rounded-xl",style:{backgroundColor:i.PRIMARY,color:i.WHITE},onClick:()=>b("/otp-verification?type=phone"),children:"Verify Phone Number"})]})})]})]}),J=()=>{const s=new FormData;s.append("userId",(r==null?void 0:r.id.toString())||""),s.append("role",(r==null?void 0:r.role)||""),s.append("verificationData",JSON.stringify(c)),x&&s.append("faceImage",x),u&&s.append("licenseImage",u),I.mutate(s)},O=()=>{if((r==null?void 0:r.role)==="DRIVER"){const s=c;switch(a){case 0:return s.licenseNumber&&s.licenseExpiry&&u;case 1:return s.vehicleType&&s.vehiclePlate&&s.vehicleModel&&s.vehicleYear;case 2:return s.faceVerification&&x;default:return!1}}else{const s=r==null?void 0:r.isVerified,l=c.phoneVerification;return a===0?s:a===1?l:c.faceVerification&&x}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-white p-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:i.SECONDARY},children:"Identity Verification"}),e.jsx("p",{className:"text-gray-600",children:"Complete your verification to access all features"}),e.jsxs("div",{className:"mt-6",children:[e.jsx(ee,{value:S,className:"h-2"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[Math.round(S),"% Complete"]})]})]}),e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("div",{className:"flex space-x-4 overflow-x-auto pb-2",children:f.map((s,l)=>e.jsxs("div",{className:`flex items-center space-x-2 px-4 py-2 rounded-full border-2 cursor-pointer transition-colors duration-300 ${l===a?"bg-blue-100 border-blue-500 text-blue-700":s.completed||(r==null?void 0:r.role)==="CONSUMER"&&l<2&&(r!=null&&r.isVerified)&&l===0||(r==null?void 0:r.role)==="CONSUMER"&&l<2&&c.phoneVerification&&l===1?"bg-green-100 border-green-500 text-green-700":"bg-gray-100 border-gray-300 text-gray-600"}`,onClick:()=>C(l),children:[s.completed||(r==null?void 0:r.role)==="CONSUMER"&&l<2&&(r!=null&&r.isVerified)&&l===0||(r==null?void 0:r.role)==="CONSUMER"&&l<2&&c.phoneVerification&&l===1?e.jsx(P,{className:"h-5 w-5 text-green-600"}):e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center font-bold text-xs ${l===a?"border-blue-500 bg-blue-500 text-white":"border-gray-400 text-gray-400"}`,children:l+1}),e.jsx("span",{className:"text-sm font-medium",children:s.title})]},s.id))})}),e.jsx("div",{className:"mb-8",children:(r==null?void 0:r.role)==="DRIVER"?e.jsxs(e.Fragment,{children:[a===0&&X(),a===1&&z(),a===2&&D()]}):e.jsxs(e.Fragment,{children:[a===0&&F(),a===1&&F(),a===2&&D()]})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(t,{variant:"outline",onClick:()=>a>0?C(a-1):b((r==null?void 0:r.role)==="DRIVER"?"/driver-dashboard":"/consumer-home"),className:"rounded-xl",disabled:a===0,children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),a===0?"Back to Dashboard":"Previous"]}),a<f.length-1?e.jsxs(t,{onClick:()=>{const s=[...f];s[a].completed=!0,Y(s.filter(l=>l.completed).length/s.length*100),C(a+1)},disabled:!O(),className:"rounded-xl",style:{backgroundColor:i.PRIMARY,color:i.WHITE},children:["Next",e.jsx(fe,{className:"h-4 w-4 ml-2"})]}):e.jsx(t,{onClick:J,disabled:!O()||I.isPending,className:"rounded-xl",style:{backgroundColor:i.ACTIVE,color:i.WHITE},children:I.isPending?"Submitting...":"Complete Verification"})]})]})})}export{Re as default};
//# sourceMappingURL=identity-verification-BepOhkwP.js.map

import{c as q,u as B,a as z,b as $,r as c,d as _,e as D,f as G,M as J,j as e,B as n,A as O,g as p,h as Z,X as ee,P as se,C as le,F as te,i as m}from"./index-CVqmz7v7.js";import{a as v}from"./account_circle-ChEtdL0c.js";import{c as re}from"./camera_icon-D5N9eZPD.js";import{M as U}from"./message-circle-CqxJZh1m.js";import{P as C}from"./phone-0BJ47FE1.js";import{C as ae}from"./camera-CLhouQFu.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=q("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),l={PRIMARY:"#4682b4",SECONDARY:"#0b1a51",TEXT:"#131313",WHITE:"#ffffff"};function xe(){const[,T]=B(),{user:s}=z(),h=$(),[x,b]=c.useState(""),[o,R]=c.useState(null),[Y,w]=c.useState(!1),[I,y]=c.useState(!1),[P,N]=c.useState(!1),[g,u]=c.useState(!1),M=c.useRef(null),{connected:X,chatMessages:j,sendChatMessage:F,connectionError:A}=_(),{data:f=[],isLoading:H}=D({queryKey:["/api/conversations",s==null?void 0:s.id,s==null?void 0:s.role],queryFn:async()=>{const t=await fetch(`/api/conversations?userId=${s==null?void 0:s.id}&role=${s==null?void 0:s.role}`);if(!t.ok)throw new Error("Failed to fetch conversations");return t.json()},enabled:!!(s!=null&&s.id)}),{data:k=[],isLoading:W}=D({queryKey:["/api/conversations",o,"messages"],queryFn:async()=>{const t=await fetch(`/api/conversations/${o}/messages`);if(!t.ok)throw new Error("Failed to fetch messages");return t.json()},enabled:!!o}),K=G({mutationFn:async t=>{const a=await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,senderId:s==null?void 0:s.id})});if(!a.ok)throw new Error("Failed to send message");return a.json()},onSuccess:t=>{if(h.invalidateQueries({queryKey:["/api/conversations",o,"messages"]}),h.invalidateQueries({queryKey:["/api/conversations",s==null?void 0:s.id]}),b(""),o){const a=f.find(i=>i.id===o);if(a){let i,d;(s==null?void 0:s.role)==="CONSUMER"?(i=a.vendorId.toString(),d=m.MERCHANT):(s==null?void 0:s.role)==="MERCHANT"?(i=a.customerId.toString(),d=m.CONSUMER):(s==null?void 0:s.role)==="DRIVER"?a.conversationType==="PICKUP"?(i=a.vendorId.toString(),d=m.MERCHANT):(i=a.customerId.toString(),d=m.CONSUMER):(i=a.customerId.toString(),d=m.CONSUMER),F(i,d,t.content)}}}});c.useEffect(()=>{j.length>0&&o&&j.filter(a=>a.type===J.CHAT_MESSAGE&&(a.senderId===String(s==null?void 0:s.id)||a.recipientId===String(s==null?void 0:s.id))).length>0&&h.invalidateQueries({queryKey:["/api/conversations",o,"messages"]})},[j,o,s==null?void 0:s.id,h]),c.useEffect(()=>{var t;(t=M.current)==null||t.scrollIntoView({behavior:"smooth"})},[k]);const L=()=>{!x.trim()||!o||K.mutate({conversationId:o,content:x.trim(),messageType:"TEXT"})},Q=t=>{R(t),w(!0)},V=()=>{w(!1),R(null),y(!1),N(!1),u(!1)},E=t=>{switch(y(!1),t){case"camera":console.log("Opening camera...");break;case"photo":console.log("Opening photo gallery...");break;case"document":console.log("Opening document picker...");break}},S=t=>{switch(N(!1),t){case"in-app":console.log("Starting in-app call...");break;case"cellular":console.log("Starting cellular call...");break}};if(!s)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen",style:{backgroundColor:l.WHITE},children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",style:{color:l.TEXT},children:"Please Sign In"}),e.jsx("p",{className:"mb-4",style:{color:l.TEXT+"80"},children:"You need to be signed in to access chat"}),e.jsx(n,{onClick:()=>T("/signin"),className:"rounded-3xl py-3 px-6",style:{backgroundColor:l.PRIMARY,color:l.WHITE},children:"Sign In"})]});if(!Y)return e.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"#F8F9FA"},children:[e.jsx("div",{className:"p-6 pb-4",style:{backgroundColor:l.WHITE},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{variant:"ghost",onClick:()=>T("/dashboard"),className:"p-2 rounded-2xl hover:bg-gray-100",children:e.jsx(O,{className:"h-6 w-6",style:{color:l.TEXT}})}),e.jsx("h1",{className:"text-2xl font-bold",style:{color:l.TEXT},children:"Messages"}),e.jsx("div",{className:"w-10"})]})}),e.jsx("div",{className:"px-4 pb-6",children:H?e.jsxs("div",{className:"p-8 text-center",style:{color:l.TEXT+"80"},children:[e.jsx(U,{className:"h-12 w-12 mx-auto mb-4",style:{color:l.PRIMARY}}),e.jsx("p",{children:"Loading conversations..."})]}):f.length===0?e.jsxs("div",{className:"p-8 text-center",style:{color:l.TEXT+"80"},children:[e.jsx(U,{className:"h-16 w-16 mx-auto mb-4",style:{color:l.PRIMARY+"40"}}),e.jsx("h3",{className:"text-lg font-medium mb-2",style:{color:l.TEXT},children:"No conversations yet"}),e.jsxs("p",{children:[(s==null?void 0:s.role)==="CONSUMER"&&"Start shopping to connect with merchants",(s==null?void 0:s.role)==="MERCHANT"&&"Customers will contact you about quotes and orders",(s==null?void 0:s.role)==="DRIVER"&&"You'll receive pickup and delivery requests here"]})]}):e.jsx("div",{className:"space-y-3",children:f.map(t=>e.jsx("div",{onClick:()=>Q(t.id),className:"rounded-3xl p-4 cursor-pointer transition-all duration-200 hover:shadow-lg card-3d",style:{backgroundColor:l.WHITE,border:"1px solid #E5E7EB"},children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden border-2",style:{borderColor:l.PRIMARY+"40"},children:(()=>{let a=null;return(s==null?void 0:s.role)==="CONSUMER"?a=t.vendorPhoto:(s==null?void 0:s.role)==="MERCHANT"?a=t.customerPhoto:(s==null?void 0:s.role)==="DRIVER"&&(a=t.conversationType==="PICKUP"?t.vendorPhoto:t.customerPhoto),a?e.jsx("img",{src:a,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:l.PRIMARY+"20"},children:e.jsx("img",{src:v,alt:"Profile",className:"w-12 h-12",style:{filter:"brightness(0) saturate(100%) invert(27%) sepia(51%) saturate(2878%) hue-rotate(176deg) brightness(102%) contrast(97%)"}})})})()}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 rounded-full border-2",style:{backgroundColor:"#10B981",borderColor:l.WHITE}})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:"font-semibold text-lg truncate",style:{color:l.TEXT},children:(s==null?void 0:s.role)==="CONSUMER"?t.vendorName:(s==null?void 0:s.role)==="MERCHANT"?t.customerName:(s==null?void 0:s.role)==="DRIVER"?t.conversationType==="PICKUP"?t.vendorName:t.customerName:"Unknown"}),e.jsx("span",{className:"text-xs",style:{color:l.TEXT+"60"},children:new Date(t.lastMessageAt).toLocaleDateString()})]}),t.productName&&e.jsxs("p",{className:"text-sm mb-2 truncate",style:{color:l.PRIMARY},children:["About: ",t.productName]}),t.lastMessage&&e.jsx("p",{className:"text-sm truncate",style:{color:l.TEXT+"70"},children:t.lastMessage}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx(p,{variant:"default",className:"rounded-full px-3 py-1",style:{backgroundColor:(()=>{switch(t.conversationType){case"QUOTE":return"#FEF3C7";case"ORDER":return"#DBEAFE";case"PICKUP":return"#FECACA";case"DELIVERY":return"#D1FAE5";default:return l.PRIMARY+"20"}})(),color:(()=>{switch(t.conversationType){case"QUOTE":return"#92400E";case"ORDER":return"#1E40AF";case"PICKUP":return"#DC2626";case"DELIVERY":return"#059669";default:return l.PRIMARY}})()},children:t.conversationType}),e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:l.PRIMARY}})]})]})]})},t.id))})})]});const r=f.find(t=>t.id===o);return e.jsxs("div",{className:"h-screen flex flex-col",style:{backgroundColor:l.WHITE},children:[e.jsxs("div",{className:"p-4 border-b",style:{borderColor:"#E5E7EB",backgroundColor:l.WHITE},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(n,{variant:"ghost",onClick:V,className:"p-2 rounded-2xl hover:bg-gray-100",children:e.jsx(O,{className:"h-6 w-6",style:{color:l.TEXT}})}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden border-2 cursor-pointer hover:opacity-80",style:{borderColor:l.PRIMARY+"40"},onClick:()=>u(!g),children:(()=>{let t=null;return(s==null?void 0:s.role)==="CONSUMER"?t=r.vendorPhoto:(s==null?void 0:s.role)==="MERCHANT"?t=r.customerPhoto:(s==null?void 0:s.role)==="DRIVER"&&(t=r.conversationType==="PICKUP"?r.vendorPhoto:r.customerPhoto),t?e.jsx("img",{src:t,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:l.PRIMARY+"20"},children:e.jsx("img",{src:v,alt:"Profile",className:"w-8 h-8",style:{filter:"brightness(0) saturate(100%) invert(27%) sepia(51%) saturate(2878%) hue-rotate(176deg) brightness(102%) contrast(97%)"}})})})()}),e.jsxs("div",{className:"cursor-pointer",onClick:()=>u(!g),children:[e.jsx("h2",{className:"font-semibold text-lg",style:{color:l.TEXT},children:(s==null?void 0:s.role)==="CONSUMER"?r.vendorName:(s==null?void 0:s.role)==="MERCHANT"?r.customerName:(s==null?void 0:s.role)==="DRIVER"?r.conversationType==="PICKUP"?r.vendorName:r.customerName:"Unknown"}),r.productName&&e.jsxs("p",{className:"text-sm",style:{color:l.TEXT+"70"},children:["About: ",r.productName]}),e.jsx("p",{className:"text-xs",style:{color:l.PRIMARY},children:"Tap to view profile"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[r&&e.jsx(p,{variant:"default",className:"rounded-full",style:{backgroundColor:(()=>{switch(r.conversationType){case"QUOTE":return"#FEF3C7";case"ORDER":return"#DBEAFE";case"PICKUP":return"#FECACA";case"DELIVERY":return"#D1FAE5";default:return l.PRIMARY+"20"}})(),color:(()=>{switch(r.conversationType){case"QUOTE":return"#92400E";case"ORDER":return"#1E40AF";case"PICKUP":return"#DC2626";case"DELIVERY":return"#059669";default:return l.PRIMARY}})()},children:r.conversationType}),e.jsx(n,{variant:"ghost",size:"sm",className:"rounded-full p-2 relative",onClick:()=>N(!P),children:e.jsx(C,{className:"h-5 w-5",style:{color:l.PRIMARY}})}),e.jsx(n,{variant:"ghost",size:"sm",className:"rounded-full p-2",children:e.jsx(Z,{className:"h-5 w-5",style:{color:l.PRIMARY}})})]})]}),g&&r&&e.jsx("div",{className:"absolute top-16 left-4 right-4 z-50",children:e.jsxs("div",{className:"rounded-3xl p-6 shadow-xl border",style:{backgroundColor:l.WHITE,borderColor:l.PRIMARY+"30"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:l.TEXT},children:"Public Profile"}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>u(!1),className:"rounded-full",children:e.jsx(ee,{className:"h-4 w-4",style:{color:l.TEXT}})})]}),e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden border-2",style:{borderColor:l.PRIMARY+"40"},children:(()=>{let t=null;return(s==null?void 0:s.role)==="CONSUMER"?t=r.vendorPhoto:(s==null?void 0:s.role)==="MERCHANT"?t=r.customerPhoto:(s==null?void 0:s.role)==="DRIVER"&&(t=r.conversationType==="PICKUP"?r.vendorPhoto:r.customerPhoto),t?e.jsx("img",{src:t,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:l.PRIMARY+"20"},children:e.jsx("img",{src:v,alt:"Profile",className:"w-12 h-12",style:{filter:"brightness(0) saturate(100%) invert(27%) sepia(51%) saturate(2878%) hue-rotate(176deg) brightness(102%) contrast(97%)"}})})})()}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-xl",style:{color:l.TEXT},children:(s==null?void 0:s.role)==="CONSUMER"?r.vendorName:(s==null?void 0:s.role)==="MERCHANT"?r.customerName:(s==null?void 0:s.role)==="DRIVER"?r.conversationType==="PICKUP"?r.vendorName:r.customerName:"Unknown"}),e.jsx("p",{className:"text-sm",style:{color:l.TEXT+"70"},children:(s==null?void 0:s.role)==="CONSUMER"?"Merchant":(s==null?void 0:s.role)==="MERCHANT"?"Customer":(s==null?void 0:s.role)==="DRIVER"?r.conversationType==="PICKUP"?"Merchant (Pickup)":"Customer (Delivery)":"User"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 mr-2"}),e.jsx("span",{className:"text-xs",style:{color:l.TEXT+"70"},children:"Online"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",style:{color:l.TEXT},children:"Interaction Type"}),e.jsx("p",{className:"text-sm",style:{color:l.TEXT+"70"},children:(()=>{switch(r.conversationType){case"QUOTE":return"Quote Discussion";case"ORDER":return"Order Management";case"PICKUP":return"Pickup Request";case"DELIVERY":return"Delivery Service";default:return"General Communication"}})()})]}),r.productName&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",style:{color:l.TEXT},children:"Current Discussion"}),e.jsx("p",{className:"text-sm",style:{color:l.PRIMARY},children:r.productName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",style:{color:l.TEXT},children:"Member Since"}),e.jsx("p",{className:"text-sm",style:{color:l.TEXT+"70"},children:new Date(r.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long"})})]})]})]})}),P&&e.jsx("div",{className:"absolute top-16 right-4 z-50",children:e.jsxs("div",{className:"rounded-3xl p-4 shadow-xl border min-w-48",style:{backgroundColor:l.WHITE,borderColor:l.PRIMARY+"30"},children:[e.jsx("h4",{className:"text-sm font-semibold mb-3",style:{color:l.TEXT},children:"Call Options"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{variant:"ghost",onClick:()=>S("in-app"),className:"w-full justify-start rounded-2xl p-3 hover:bg-gray-50",children:[e.jsx(C,{className:"h-4 w-4 mr-3",style:{color:l.PRIMARY}}),e.jsx("span",{style:{color:l.TEXT},children:"In-App Call"})]}),e.jsxs(n,{variant:"ghost",onClick:()=>S("cellular"),className:"w-full justify-start rounded-2xl p-3 hover:bg-gray-50",children:[e.jsx(C,{className:"h-4 w-4 mr-3",style:{color:l.SECONDARY}}),e.jsx("span",{style:{color:l.TEXT},children:"Cellular Call"})]})]})]})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",style:{backgroundColor:"#F8F9FA"},children:[X?e.jsx("div",{className:"text-center",children:e.jsx(p,{variant:"default",className:"rounded-full px-3 py-1 mb-2",style:{backgroundColor:"#D1FAE5",color:"#059669"},children:"Real-time connected"})}):A?e.jsx("div",{className:"text-center",children:e.jsx(p,{variant:"default",className:"rounded-full px-3 py-1 mb-2",style:{backgroundColor:"#FEE2E2",color:"#DC2626"},children:A})}):null,W?e.jsx("div",{className:"text-center py-8",style:{color:l.TEXT+"80"},children:"Loading messages..."}):k.map(t=>{const a=t.senderId===(s==null?void 0:s.id);return e.jsx("div",{className:`flex ${a?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[70%] ${a?"order-2":"order-1"}`,children:e.jsxs("div",{className:"rounded-2xl p-4 shadow-sm",style:{backgroundColor:a?l.PRIMARY:l.SECONDARY,color:l.WHITE,fontFamily:"Montserrat",fontWeight:"500"},children:[t.messageType==="QUOTE_REQUEST"&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-3 mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{className:"h-4 w-4 text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-800",children:"Quote Request"})]})}),t.messageType==="QUOTE_RESPONSE"&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-3 mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-800",children:"Quote Response"})]})}),e.jsx("p",{className:"text-sm leading-relaxed",children:t.content}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("span",{className:"text-xs opacity-80",children:t.senderName}),e.jsx("span",{className:"text-xs opacity-70",children:new Date(t.createdAt).toLocaleTimeString()})]})]})})},t.id)}),e.jsx("div",{ref:M})]}),e.jsxs("div",{className:"p-5 relative",style:{backgroundColor:l.WHITE},children:[I&&e.jsx("div",{className:"absolute bottom-20 right-5 z-50",children:e.jsxs("div",{className:"rounded-3xl p-4 shadow-xl border min-w-48",style:{backgroundColor:l.WHITE,borderColor:"#A7C7E7"},children:[e.jsx("h4",{className:"text-sm font-semibold mb-3",style:{color:l.TEXT},children:"Add Attachment"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{variant:"ghost",onClick:()=>E("camera"),className:"w-full justify-start rounded-2xl p-3 hover:bg-gray-50",children:[e.jsx(ae,{className:"h-4 w-4 mr-3",style:{color:l.PRIMARY}}),e.jsx("span",{style:{color:l.TEXT},children:"Take Photo"})]}),e.jsxs(n,{variant:"ghost",onClick:()=>E("photo"),className:"w-full justify-start rounded-2xl p-3 hover:bg-gray-50",children:[e.jsx(oe,{className:"h-4 w-4 mr-3",style:{color:l.PRIMARY}}),e.jsx("span",{style:{color:l.TEXT},children:"Upload Photo"})]}),e.jsxs(n,{variant:"ghost",onClick:()=>E("document"),className:"w-full justify-start rounded-2xl p-3 hover:bg-gray-50",children:[e.jsx(te,{className:"h-4 w-4 mr-3",style:{color:l.SECONDARY}}),e.jsx("span",{style:{color:l.TEXT},children:"Upload Document"})]})]})]})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex-1 relative",children:e.jsx("div",{className:"rounded-3xl px-4 py-4",style:{border:"2px solid #A7C7E7",backgroundColor:l.WHITE},children:e.jsx("input",{value:x,onChange:t=>b(t.target.value),placeholder:"Message...",onKeyPress:t=>t.key==="Enter"&&L(),className:"w-full bg-transparent outline-none text-base",style:{color:x?l.TEXT:"#D9D9D9",fontFamily:"Montserrat",fontWeight:"400"}})})}),e.jsx(n,{onClick:()=>y(!I),className:"w-15 h-15 p-0 rounded-full hover:opacity-80 transition-opacity",style:{border:"2px solid #A7C7E7",backgroundColor:l.WHITE},children:e.jsx("img",{src:re,alt:"Attachment",className:"w-10 h-10",style:{filter:"brightness(0) saturate(100%) invert(27%) sepia(51%) saturate(2878%) hue-rotate(176deg) brightness(102%) contrast(97%)"}})})]})]})]})}export{xe as default};
//# sourceMappingURL=chat-BChPrQyM.js.map
